=== í´ë” êµ¬ì¡° ===
kanade-ai/
â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ css/
â”‚   â”‚   â””â”€â”€ style.css
â”‚   â”œâ”€â”€ images/
â”‚   â”‚   â”œâ”€â”€ emojis/
â”‚   â”‚   â”‚   â”œâ”€â”€ (ë¬¼ìŒí‘œë‹¤ì„¯ê°œë¥¼ë„ìš°ë©°)ë‹¹í™©.png
â”‚   â”‚   â”‚   â”œâ”€â”€ (ì†ì„ë‚´ë°€ë©°)ë„¤ê°€í•„ìš”í•´.gif
â”‚   â”‚   â”‚   â”œâ”€â”€ (ì‘ì—…ë„ì¤‘)ë†€ëŒ.gif
â”‚   â”‚   â”‚   â”œâ”€â”€ (ì‘ì—…ë„ì¤‘)ë’¤ëŒì•„ë³´ê¸°.gif
â”‚   â”‚   â”‚   â”œâ”€â”€ ê·€ì—¬ìš´ì²™.png
â”‚   â”‚   â”‚   â”œâ”€â”€ ê¸°ëŒ€ì¤‘.png
â”‚   â”‚   â”‚   â”œâ”€â”€ ë‚´ë†”.png
â”‚   â”‚   â”‚   â”œâ”€â”€ ë…¸ë˜ë¶€ë¥´ê¸°.png
â”‚   â”‚   â”‚   â”œâ”€â”€ ë†€ëŒ.png
â”‚   â”‚   â”‚   â”œâ”€â”€ ëˆˆì¹˜ë³´ëŠ”ì¤‘.png
â”‚   â”‚   â”‚   â”œâ”€â”€ ë§Œì¡±ìŠ¤ëŸ¬ìš´í‘œì •.png
â”‚   â”‚   â”‚   â”œâ”€â”€ ë©”ë¡±.png
â”‚   â”‚   â”‚   â”œâ”€â”€ ë©”ëª¨.png
â”‚   â”‚   â”‚   â”œâ”€â”€ ë¶€ë„ëŸ¬ì›€.png
â”‚   â”‚   â”‚   â”œâ”€â”€ ë¹¤íˆì³ë‹¤ë³´ê¸°.png
â”‚   â”‚   â”‚   â”œâ”€â”€ ì“°ë‹¤ë“¬ì–´ì£¼ê¸°.png
â”‚   â”‚   â”‚   â”œâ”€â”€ ì•ˆë¼ì• .png
â”‚   â”‚   â”‚   â”œâ”€â”€ ì•ˆì•„ì£¼ê¸°.png
â”‚   â”‚   â”‚   â”œâ”€â”€ ì›ƒìœ¼ë©°ì†ë‚´ë°€ê¸°.png
â”‚   â”‚   â”‚   â”œâ”€â”€ ìŒì•…ê°ìƒ.gif
â”‚   â”‚   â”‚   â”œâ”€â”€ ì´ê±°ì§„ì§œì—ìš”.png
â”‚   â”‚   â”‚   â”œâ”€â”€ ì¸ì •ã„¹ã…‡ã…‹ã…‹.png
â”‚   â”‚   â”‚   â”œâ”€â”€ ì˜ì.png
â”‚   â”‚   â”‚   â”œâ”€â”€ ì ˆë§.gif
â”‚   â”‚   â”‚   â”œâ”€â”€ ì¢‹ì•„ìš”ë²„íŠ¼ëˆ„ë¥´ê¸°.png
â”‚   â”‚   â”‚   â”œâ”€â”€ ì§€ì³¤ì–´.png
â”‚   â”‚   â”‚   â”œâ”€â”€ í‚¤ë³´ë“œì—°ì£¼.gif
â”‚   â”‚   â”‚   â””â”€â”€ í—¤ë“œí°ì†Œë¦¬ì—ì§‘ì¤‘.gif
â”‚   â”‚   â””â”€â”€ kanade-profile.webp
â”‚   â”œâ”€â”€ js/
â”‚   â”‚   â”œâ”€â”€ admin.js
â”‚   â”‚   â”œâ”€â”€ chat.js
â”‚   â”‚   â”œâ”€â”€ login.js
â”‚   â”‚   â””â”€â”€ register.js
â”‚   â”œâ”€â”€ admin.html
â”‚   â”œâ”€â”€ chat.html
â”‚   â”œâ”€â”€ login.html
â”‚   â””â”€â”€ register.html
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ auth.js
â”‚   â”œâ”€â”€ gemini.js
â”‚   â”œâ”€â”€ index.js
â”‚   â””â”€â”€ utils.js
â”œâ”€â”€ readme.md
â””â”€â”€ wrangler.toml

=== ì œì™¸ëœ í´ë” ì •ë³´ ===
.git/ - Git ë²„ì „ ê´€ë¦¬ í´ë”ì…ë‹ˆë‹¤.

=== ì½”ë“œ íŒŒì¼ ë‚´ìš© ===

===== public\admin.html =====
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê´€ë¦¬ì í˜ì´ì§€ - ì¹´ë‚˜ë° ì±—ë´‡</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <div class="admin-container">
        <div class="auth-card">
            <div class="auth-header">
                <h2>ê´€ë¦¬ì í˜ì´ì§€</h2>
                <p>ê³µì§€ì‚¬í•­ ê´€ë¦¬</p>
            </div>

            <div id="loginSection">
                <form id="adminLoginForm">
                    <div class="form-group">
                        <label for="adminPassword" class="form-label">ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸</label>
                        <input type="password" class="form-control" id="adminPassword" name="password" required>
                    </div>
                    <button type="submit" class="btn btn-primary w-100">ë¡œê·¸ì¸</button>
                </form>
            </div>

            <div id="adminPanel" style="display: none;">
                <form id="noticeForm">
                    <div class="form-group">
                        <label for="noticeContent" class="form-label">ê³µì§€ì‚¬í•­ ë‚´ìš©</label>
                        <textarea class="form-control" id="noticeContent" name="content" rows="5" required></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary w-100">ê³µì§€ì‚¬í•­ ì—…ë°ì´íŠ¸</button>
                </form>
                <div class="text-center mt-3">
                    <button id="logoutAdminBtn" class="btn btn-secondary w-100">ë¡œê·¸ì•„ì›ƒ</button>
                </div>
            </div>
            
            <div id="errorMessage" class="error-message mt-3" style="display: none;"></div>
            <div id="successMessage" class="success-message mt-3" style="display: none;"></div>
        </div>
    </div>
    <script src="/js/admin.js"></script>
</body>
</html>

==================================================

===== public\chat.html =====
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¹´ë‚˜ë° ì±—ë´‡</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.5/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <div class="chat-container">
        <button id="sidebarToggle" class="sidebar-toggle"><i class="bi bi-list"></i></button>
        
        <div id="sidebar" class="sidebar p-3">
            <div class="accordion" id="settingsAccordion">
                <!-- ì‚¬ìš©ì ì •ë³´ -->
                <div class="form-section">
                    <h6><i class="bi bi-person-lines-fill"></i> | ì‚¬ìš©ì ì •ë³´</h6>
                    <div id="userInfo"></div>
                </div>
                
                <!-- ê³µì§€ì‚¬í•­ -->
                <div class="form-section notice-section">
                    <h6><i class="bi bi-info-circle"></i> | ê³µì§€ì‚¬í•­</h6>
                    <p id="noticeContent"></p>
                </div>

                <!-- ëŒ€í™”ë‚´ì—­ -->
                <div class="form-section">
                    <h6><i class="bi bi-card-list"></i> | ëŒ€í™”ë‚´ì—­</h6>
                    <button id="newConversationBtn" class="btn btn-primary w-100 mb-2">ìƒˆ ëŒ€í™” ì‹œì‘</button>
                    <div id="conversationList"></div>
                </div>

                <!-- ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ -->
                <div class="form-section">
                    <h6><i class="bi bi-lock"></i> | ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</h6>
                    <form id="changePasswordForm">
                        <input type="password" name="current_password" class="form-control mb-2" placeholder="í˜„ì¬ ë¹„ë°€ë²ˆí˜¸" required>
                        <input type="password" name="new_password" class="form-control mb-2" placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸" required>
                        <input type="password" name="confirm_password" class="form-control mb-2" placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸ í™•ì¸" required>
                        <button type="submit" class="btn btn-secondary w-100">ë³€ê²½í•˜ê¸°</button>
                    </form>
                </div>

                <!-- ë‹‰ë„¤ì„ ë³€ê²½ -->
                <div class="form-section">
                    <h6><i class="bi bi-people"></i> | ë‹‰ë„¤ì„ ë³€ê²½</h6>
                    <form id="changeNicknameForm">
                        <input type="text" name="new_nickname" class="form-control mb-2" placeholder="ìƒˆ ë‹‰ë„¤ì„" required>
                        <button type="submit" class="btn btn-secondary w-100">ë³€ê²½í•˜ê¸°</button>
                    </form>
                </div>

                <!-- API í‚¤ ê´€ë¦¬ -->
                <div class="form-section">
                    <h6><i class="bi bi-code-slash"></i> | ê°œì¸ API í‚¤ ê´€ë¦¬</h6>
                    <form id="apiKeyForm">
                        <input type="password" name="api_key" id="apiKeyInput" class="form-control mb-2 masked-input" placeholder="ê°œì¸ Gemini API í‚¤">
                        <div>
                            <button type="submit" id="apiKeySubmitBtn" class="btn btn-secondary">ë“±ë¡í•˜ê¸°</button>
                            <button type="button" id="deleteApiKeyBtn" class="btn btn-danger" style="display: none;">ì‚­ì œí•˜ê¸°</button>
                        </div>
                    </form>
                </div>

                <!-- ë¡œê·¸ì•„ì›ƒ -->
                <button id="logoutBtn" class="btn btn-danger w-100">ë¡œê·¸ì•„ì›ƒ</button>
            </div>
        </div>

        <div class="chat-main">
            <!-- ì±„íŒ… í—¤ë” (ì¹´ë‚˜ë° í”„ë¡œí•„ + ëª¨ë¸ ì„ íƒ + ì´ë¯¸ì§€ í† ê¸€) -->
            <div class="chat-header">
                <div class="profile-section">
                    <img src="/images/kanade-profile.webp" alt="ì¹´ë‚˜ë°" class="profile-image">
                    <div class="profile-info">
                        <h5 class="profile-name">ìš”ì´ì‚¬í‚¤ ì¹´ë‚˜ë°</h5>
                        <p class="profile-status"><i class="bi bi-cloud-check-fill"></i> | ì˜¨ë¼ì¸</p>
                    </div>
                </div>
                
                <div class="header-controls">
                    <div class="model-selector-section">
                        <label for="modelSelect" class="form-label">ëª¨ë¸:</label>
                        <select id="modelSelect" class="form-select model-select">
                            <option value="gemini-2.5-flash" selected>Gemini 2.5 Flash</option>
                            <option value="gemini-2.5-pro">Gemini 2.5 Pro</option>
                            <option value="gemini-2.5-flash-lite-preview-06-17">Gemini 2.5 Flash Lite</option>
                            <option value="gemini-2.0-flash">Gemini 2.0 Flash</option>
                            <option value="gemini-2.0-flash-lite">Gemini 2.0 Flash Lite</option>
                        </select>
                    </div>
                    
                    <div class="image-toggle-section">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="imageToggle" checked>
                            <label class="form-check-label" for="imageToggle">
                                ì´ë¯¸ì§€ ë³´ì—¬ì£¼ê¸°
                            </label>
                            <button type="button" class="btn btn-link p-0 ms-2" id="imageToggleInfo" data-bs-toggle="tooltip" data-bs-placement="bottom" title="ì¹´ë‚˜ë°ê°€ ì´ë¯¸ì§€ë¥¼ ë³´ê³  ë‹µë³€í• ì§€ ê²°ì •í•©ë‹ˆë‹¤. ë‹µë³€ ì†ë„ê°€ ëŠë¦¬ë‹¤ë©´ ì´ ì˜µì…˜ì„ êº¼ë³´ì„¸ìš”.">
                                <i class="bi bi-info-circle"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="chatMessages" class="chat-messages">
                <div class="message assistant">
                    <img src="/images/kanade-profile.webp" alt="ì¹´ë‚˜ë°" class="message-avatar">
                    <div class="message-content">
                        <div class="message-bubble">. . .</div>
                    </div>
                </div>
            </div>
            
            <div class="chat-input">
                <div class="input-group">
                    <input type="file" id="imageInput" accept="image/*" style="display: none;">
                    <button id="imageUploadBtn" class="upload-button" title="ì´ë¯¸ì§€ ì—…ë¡œë“œ">
                        <i class="bi bi-image"></i>
                    </button>
                    <textarea id="messageInput" class="chat-input-field" placeholder="ì¹´ë‚˜ë°ì—ê²Œ ë©”ì‹œì§€ ë³´ë‚´ê¸°... (Shift+Enter: ì¤„ë°”ê¿ˆ, Enter: ì „ì†¡)" rows="1"></textarea>
                    <button id="sendButton" class="send-button"><i class="bi bi-send-fill"></i></button>
                </div>
            </div>
        </div>
    </div>

    <!-- ì—…ë¡œë“œ ì§„í–‰ë¥  ëª¨ë‹¬ -->
    <div class="modal fade" id="uploadModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-sm">
            <div class="modal-content">
                <div class="modal-body text-center">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-2"><i class="bi bi-cloud-arrow-up"></i> | ì´ë¯¸ì§€ ì—…ë¡œë“œ ì¤‘...</p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/js/chat.js"></script>
</body>
</html>

==================================================

===== public\css\style.css =====
:root {
  --bg-color: #ffffff;
  --button-color: #87CEEB;
  --button-hover-color: #4682B4;
  --text-color: #333333;
  --border-color: #e0e0e0;
  --sidebar-bg: #f8f9fa;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background-color: var(--bg-color);
  color: var(--text-color);
  line-height: 1.6;
}

.btn-primary {
  background-color: var(--button-color) !important;
  border-color: var(--button-color) !important;
  color: var(--text-color) !important;
  transition: all 0.3s ease;
}

.btn-primary:hover {
  background-color: var(--button-hover-color) !important;
  border-color: var(--button-hover-color) !important;
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}

.btn-secondary {
  background-color: #f8f9fa !important;
  border-color: var(--border-color) !important;
  color: var(--text-color) !important;
  transition: all 0.3s ease;
}

.btn-secondary:hover {
  background-color: #e2e6ea !important;
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.chat-container {
  height: 100vh;
  display: flex;
}

.sidebar {
  width: 300px;
  background-color: var(--sidebar-bg);
  border-right: 1px solid var(--border-color);
  transition: margin-left 0.3s ease;
  overflow-y: auto;
}

.sidebar.collapsed {
  margin-left: -300px;
}

.sidebar-toggle {
  position: fixed;
  top: 20px;
  left: 20px;
  z-index: 1000;
  background-color: var(--button-color);
  border: none;
  border-radius: 50%;
  width: 50px;
  height: 50px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--text-color);
  transition: all 0.3s ease;
}

.sidebar-toggle:hover {
  background-color: var(--button-hover-color);
  transform: scale(1.1);
}

.chat-main {
  flex: 1;
  display: flex;
  flex-direction: column;
}

.chat-messages {
  flex: 1;
  overflow-y: auto;
  padding: 20px;
  background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
}

.message {
  margin-bottom: 15px;
  display: flex;
  gap: 10px;
}

.message.user {
  flex-direction: row-reverse;
}

.message-content {
  display: flex;
  flex-direction: column;
  max-width: 70%;
}

.message-bubble {
  max-width: 100%;
  padding: 12px 16px;
  border-radius: 18px;
  position: relative;
  word-wrap: break-word;
}

.message.user .message-bubble {
  background-color: var(--button-color);
  color: var(--text-color);
}

.message.assistant .message-bubble {
  background-color: white;
  color: var(--text-color);
  border: 1px solid var(--border-color);
}

.custom-emoji {
  margin-top: 8px;
  text-align: center;
}

.emoji-image {
  width: 60px;
  height: 60px;
  object-fit: contain;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  background: rgba(255,255,255,0.9);
}

.chat-input {
  padding: 20px;
  border-top: 1px solid var(--border-color);
  background-color: white;
}

.input-group {
  display: flex;
  gap: 10px;
}

.chat-input-field {
  flex: 1;
  border: 2px solid var(--border-color);
  border-radius: 25px;
  padding: 12px 20px;
  font-size: 16px;
  transition: border-color 0.3s ease;
  resize: none;
  min-height: 50px;
  max-height: 150px;
  overflow-y: auto;
  line-height: 1.4;
  padding: 15px 20px;
}

.chat-input-field:focus {
  outline: none;
  border-color: var(--button-color);
}

.chat-input-field::-webkit-scrollbar {
  width: 6px;
}

.chat-input-field::-webkit-scrollbar-track {
  background: #f1f1f1;
  border-radius: 10px;
}

.chat-input-field::-webkit-scrollbar-thumb {
  background: var(--button-color);
  border-radius: 10px;
}

.chat-input-field::-webkit-scrollbar-thumb:hover {
  background: var(--button-hover-color);
}

.send-button {
  background-color: var(--button-color);
  border: none;
  border-radius: 50%;
  width: 50px;
  height: 50px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--text-color);
  font-size: 18px;
  transition: all 0.3s ease;
  cursor: pointer;
}

.send-button:hover {
  background-color: var(--button-hover-color);
  transform: scale(1.1);
}

.conversation-item {
  padding: 10px;
  border-bottom: 1px solid var(--border-color);
  cursor: pointer;
  transition: background-color 0.3s ease;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.conversation-item:hover {
  background-color: rgba(135, 206, 235, 0.1);
}

.conversation-item.active {
    background-color: var(--button-color);
    color: white;
}

.conversation-item.active:hover {
    background-color: var(--button-hover-color);
}

.delete-conversation {
  color: #dc3545;
  cursor: pointer;
  transition: color 0.3s ease;
}

.delete-conversation:hover {
  color: #c82333;
}

.model-selector {
  margin-bottom: 20px;
}

.model-option {
  margin-bottom: 10px;
}

.model-description {
  font-size: 12px;
  color: #666;
  margin-left: 20px;
}

.form-section {
  margin-bottom: 30px;
  padding: 20px;
  background-color: white;
  border-radius: 8px;
  border: 1px solid var(--border-color);
}

.form-section h6 {
  margin-bottom: 15px;
  color: var(--text-color);
  font-weight: 600;
}

.masked-input {
  font-family: monospace;
  letter-spacing: 2px;
}

.login-container, .register-container, .admin-container {
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.auth-card {
  background: white;
  padding: 40px;
  border-radius: 15px;
  box-shadow: 0 15px 35px rgba(0,0,0,0.1);
  width: 100%;
  max-width: 400px;
}

.auth-header {
  text-align: center;
  margin-bottom: 30px;
}

.auth-header h2 {
  color: var(--text-color);
  margin-bottom: 10px;
}

.auth-header p {
  color: #666;
  font-size: 14px;
}

.form-group {
  margin-bottom: 20px;
}

.form-control {
  border: 2px solid var(--border-color);
  border-radius: 8px;
  padding: 12px 16px;
  font-size: 16px;
  transition: border-color 0.3s ease;
}

.form-control:focus {
  outline: none;
  border-color: var(--button-color);
  box-shadow: 0 0 0 3px rgba(135, 206, 235, 0.1);
}

.info-icon {
  color: var(--button-color);
  cursor: pointer;
  margin-left: 8px;
  transition: color 0.3s ease;
}

.info-icon:hover {
  color: var(--button-hover-color);
}

.notice-section {
  background-color: #e8f4f8;
  border: 1px solid var(--button-color);
  border-radius: 8px;
  padding: 15px;
  margin-bottom: 20px;
}

.notice-section h6 {
  color: var(--button-hover-color);
  margin-bottom: 10px;
}

.loading {
  opacity: 0.6;
  pointer-events: none;
}

.error-message {
  color: #dc3545;
  font-size: 14px;
  margin-top: 5px;
}

.success-message {
  color: #28a745;
  font-size: 14px;
  margin-top: 5px;
}

/* ì±„íŒ… í—¤ë” ìŠ¤íƒ€ì¼ */
.chat-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 15px 20px;
  background-color: white;
  border-bottom: 1px solid var(--border-color);
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.profile-section {
  display: flex;
  align-items: center;
  gap: 12px;
}

.profile-image {
  width: 50px;
  height: 50px;
  border-radius: 50%;
  object-fit: cover;
  border: 2px solid var(--button-color);
}

.profile-info {
  display: flex;
  flex-direction: column;
}

.profile-name {
  margin: 0;
  font-size: 18px;
  font-weight: 600;
  color: var(--text-color);
}

.profile-status {
  margin: 0;
  font-size: 12px;
  color: #28a745;
  font-weight: 500;
}

.model-selector-header {
  display: flex;
  align-items: center;
  gap: 8px;
}

.model-selector-header .form-label {
  margin: 0;
  font-weight: 600;
  color: var(--text-color);
}

.model-select {
  min-width: 180px;
  border: 2px solid var(--border-color);
  border-radius: 8px;
  font-size: 14px;
}

.model-select:focus {
  border-color: var(--button-color);
  box-shadow: 0 0 0 3px rgba(135, 206, 235, 0.1);
}

/* ë©”ì‹œì§€ ì•„ë°”íƒ€ ìŠ¤íƒ€ì¼ */
.message-avatar {
  width: 35px;
  height: 35px;
  border-radius: 50%;
  object-fit: cover;
  flex-shrink: 0;
}

.message.assistant {
  align-items: flex-start;
}

.message.user .message-avatar {
  display: none;
}

/* ëª¨ë°”ì¼ ë°˜ì‘í˜• */
@media (max-width: 768px) {
  .sidebar {
    width: 100%;
    position: fixed;
    z-index: 999;
    height: 100vh;
  }
  
  .sidebar.collapsed {
    margin-left: -100%;
  }
  
  .chat-main {
    margin-left: 0;
  }
  
  .sidebar-toggle {
    display: block;
  }
  
  .message-content {
    max-width: 85%;
  }
  
  .chat-header {
    flex-direction: column;
    gap: 15px;
    align-items: flex-start;
  }
  
  .model-selector-header {
    width: 100%;
    justify-content: space-between;
  }
  
  .model-select {
    flex: 1;
    min-width: auto;
  }
  
  .profile-image {
    width: 40px;
    height: 40px;
  }
  
  .message-avatar {
    width: 30px;
    height: 30px;
  }
  
  .emoji-image {
    width: 50px;
    height: 50px;
  }
}
/* ì´ë¯¸ì§€ ì—…ë¡œë“œ ê´€ë ¨ ìŠ¤íƒ€ì¼ */
.upload-button {
  background-color: var(--button-color);
  border: none;
  border-radius: 50%;
  width: 50px;
  height: 50px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--text-color);
  font-size: 18px;
  transition: all 0.3s ease;
  cursor: pointer;
}

.upload-button:hover {
  background-color: var(--button-hover-color);
  transform: scale(1.1);
}

.upload-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.uploaded-image {
  max-width: 200px;
  max-height: 200px;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.image-message {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.image-info {
  font-size: 12px;
  color: #666;
  text-align: center;
}

/* í—¤ë” ì»¨íŠ¸ë¡¤ ìŠ¤íƒ€ì¼ */
.header-controls {
    display: flex;
    flex-direction: column;
    gap: 15px;
    align-items: flex-end;
}

.model-selector-section {
    display: flex;
    align-items: center;
    gap: 8px;
}

.image-toggle-section {
    display: flex;
    align-items: center;
}

.image-toggle-section .form-check {
    margin: 0;
    display: flex;
    align-items: center;
    gap: 5px;
}

.image-toggle-section .form-check-label {
    font-size: 14px;
    color: var(--text-color);
    font-weight: 500;
}

.image-toggle-section .btn-link {
    color: var(--button-color);
    text-decoration: none;
    font-size: 16px;
}

.image-toggle-section .btn-link:hover {
    color: var(--button-hover-color);
}

/* ëª¨ë°”ì¼ ë°˜ì‘í˜• ê°œì„  */
@media (max-width: 768px) {
    .header-controls {
        width: 100%;
        align-items: stretch;
    }
    
    .model-selector-section {
        justify-content: space-between;
    }
    
    .image-toggle-section {
        justify-content: space-between;
    }
    
    .image-toggle-section .form-check {
        flex: 1;
        justify-content: space-between;
    }
}
/* ì‹œìŠ¤í…œ ë©”ì‹œì§€ ìŠ¤íƒ€ì¼ */
.system-message {
    background-color: #f8f9fa !important;
    color: #6c757d !important;
    border: 1px dashed #dee2e6 !important;
    font-style: italic;
    font-size: 14px;
    text-align: center;
}

.message.system {
    justify-content: center;
}

.message.system .message-content {
    max-width: 80%;
}

==================================================

===== public\js\admin.js =====
let isLoggedIn = false;

document.getElementById('adminLoginForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const formData = new FormData(e.target);
    const errorDiv = document.getElementById('errorMessage');
    
    try {
        // Admin login is checked by trying to get the notice with the password.
        // This is a simplified auth flow for the admin page.
        const response = await fetch('/api/admin/notice'); // First get current notice
        
        if (response.ok) {
            const data = await response.json();
            
            // In a real app, you'd verify the password against the server.
            // Here, we just check if the password is not empty for simplicity,
            // as the actual check is on the server when updating.
            // For the login simulation, we'll just proceed.
            
            isLoggedIn = true;
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('adminPanel').style.display = 'block';
            document.getElementById('noticeContent').value = data.notice;
            errorDiv.style.display = 'none';
            
            // Store password in session storage to use for the update request.
            sessionStorage.setItem('adminPassword', formData.get('password'));
        } else {
            errorDiv.textContent = 'ìœ¼....ì´....';
            errorDiv.style.display = 'block';
        }
    } catch (error) {
        errorDiv.textContent = 'ìœ¼....ì´....';
        errorDiv.style.display = 'block';
    }
});

document.getElementById('noticeForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const formData = new FormData(e.target);
    const errorDiv = document.getElementById('errorMessage');
    const successDiv = document.getElementById('successMessage');
    
    try {
        const response = await fetch('/api/admin/notice', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                password: sessionStorage.getItem('adminPassword'),
                content: formData.get('content')
            })
        });
        
        if (response.ok) {
            successDiv.textContent = 'ê³µì§€ì‚¬í•­ì´ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.';
            successDiv.style.display = 'block';
            errorDiv.style.display = 'none';
        } else {
            errorDiv.textContent = 'ìœ¼....ì´....';
            errorDiv.style.display = 'block';
            successDiv.style.display = 'none';
        }
    } catch (error) {
        errorDiv.textContent = 'ìœ¼....ì´....';
        errorDiv.style.display = 'block';
        successDiv.style.display = 'none';
    }
});

document.getElementById('logoutAdminBtn').addEventListener('click', () => {
    isLoggedIn = false;
    sessionStorage.removeItem('adminPassword');
    document.getElementById('loginSection').style.display = 'block';
    document.getElementById('adminPanel').style.display = 'none';
    document.getElementById('adminPassword').value = '';
    document.getElementById('errorMessage').style.display = 'none';
    document.getElementById('successMessage').style.display = 'none';
});

==================================================

===== public\js\chat.js =====
let currentConversationId = null;
let userInfo = null;
let lastUploadedImageData = null; // ğŸ”§ ì¶”ê°€: ë§ˆì§€ë§‰ ì—…ë¡œë“œëœ ì´ë¯¸ì§€ ë°ì´í„° ì €ì¥

// í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
document.addEventListener('DOMContentLoaded', async () => {
    try {
        console.log('í˜ì´ì§€ ë¡œë”© ì‹œì‘ - ì´ˆê¸°í™” ì§„í–‰');
        
        // ì¸ì¦ ìƒíƒœë¥¼ ë¨¼ì € í™•ì¸
        const isAuthenticated = await checkAuthentication();
        
        if (!isAuthenticated) {
            console.log('ì¸ì¦ ì‹¤íŒ¨ - ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸');
            window.location.href = '/login';
            return;
        }
        
        console.log('ì¸ì¦ ì„±ê³µ - ì´ˆê¸°í™” ì‹œì‘');
        
        // ì¸ì¦ëœ ê²½ìš°ì—ë§Œ ì´ˆê¸°í™” ì§„í–‰
        await loadUserInfo();
        await loadNotice();
        await loadConversations();
        
        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        setupEventListeners();
        
        console.log('ì´ˆê¸°í™” ì™„ë£Œ');
    } catch (error) {
        console.error('ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜:', error);
        window.location.href = '/login';
    }
});

// ì¸ì¦ ìƒíƒœ í™•ì¸ í•¨ìˆ˜
async function checkAuthentication() {
    try {
        const response = await fetch('/api/user/info');
        return response.ok;
    } catch (error) {
        console.error('ì¸ì¦ í™•ì¸ ì‹¤íŒ¨:', error);
        return false;
    }
}

// ğŸ”§ ìˆ˜ì •ëœ setupEventListeners í•¨ìˆ˜
function setupEventListeners() {
    // ì´ë¯¸ì§€ í† ê¸€ íˆ´íŒ ì´ˆê¸°í™”
    const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
    });
    
    // ì‚¬ì´ë“œë°” í† ê¸€
    document.getElementById('sidebarToggle').addEventListener('click', () => {
        document.getElementById('sidebar').classList.toggle('collapsed');
    });
    
    // ë©”ì‹œì§€ ì „ì†¡ - Enter í‚¤ ì´ë²¤íŠ¸
    document.getElementById('sendButton').addEventListener('click', sendMessage);
    document.getElementById('messageInput').addEventListener('keypress', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            sendMessage();
        }
    });
    
    // ì´ë¯¸ì§€ ì—…ë¡œë“œ ê´€ë ¨ ì´ë²¤íŠ¸
    document.getElementById('imageUploadBtn').addEventListener('click', () => {
        if (!userInfo.has_api_key) {
            alert('ì´ë¯¸ì§€ ì—…ë¡œë“œëŠ” ê°œì¸ Gemini API í‚¤ê°€ ë“±ë¡ëœ ì‚¬ìš©ìë§Œ ì´ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
            return;
        }
        document.getElementById('imageInput').click();
    });
    
    document.getElementById('imageInput').addEventListener('change', handleImageUpload);
    
    // ìƒˆ ëŒ€í™” ì‹œì‘ ë²„íŠ¼
    document.getElementById('newConversationBtn').addEventListener('click', startNewConversation);
    
    // í¼ ì´ë²¤íŠ¸ë“¤
    document.getElementById('changePasswordForm').addEventListener('submit', changePassword);
    document.getElementById('changeNicknameForm').addEventListener('submit', changeNickname);
    document.getElementById('apiKeyForm').addEventListener('submit', manageApiKey);
    document.getElementById('deleteApiKeyBtn').addEventListener('click', deleteApiKey);
    document.getElementById('logoutBtn').addEventListener('click', logout);
}

// ğŸ”§ ìˆ˜ì •ëœ ì´ë¯¸ì§€ ì—…ë¡œë“œ í•¨ìˆ˜ (Workers í”„ë¡ì‹œ ë°©ì‹ + ìë™ ë‹µë³€ ì œê±°)
async function handleImageUpload(event) {
    const file = event.target.files[0];
    if (!file) return;
    
    // ê°œì¸ API í‚¤ ì¬í™•ì¸
    if (!userInfo.has_api_key) {
        alert('ì´ë¯¸ì§€ ì—…ë¡œë“œëŠ” ê°œì¸ Gemini API í‚¤ê°€ ë“±ë¡ëœ ì‚¬ìš©ìë§Œ ì´ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
        return;
    }
    
    // íŒŒì¼ ê²€ì¦ (5MBë¡œ ìˆ˜ì •)
    if (!validateImageFile(file)) {
        alert('ì§€ì›í•˜ì§€ ì•ŠëŠ” íŒŒì¼ í˜•ì‹ì´ê±°ë‚˜ í¬ê¸°ê°€ 5MBë¥¼ ì´ˆê³¼í•©ë‹ˆë‹¤.');
        return;
    }
    
    // ëŒ€í™”ë°©ì´ ì—†ìœ¼ë©´ ìë™ ìƒì„±
    if (!currentConversationId) {
        await startNewConversation();
        if (!currentConversationId) {
            alert('ëŒ€í™”ë°© ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            return;
        }
    }
    
    const uploadModal = new bootstrap.Modal(document.getElementById('uploadModal'));
    
    try {
        uploadModal.show();
        
        // FormData ìƒì„± (Workers í”„ë¡ì‹œ ë°©ì‹)
        const formData = new FormData();
        formData.append('file', file);
        formData.append('conversationId', currentConversationId);
        
        // Workersë¥¼ í†µí•´ ì§ì ‘ ì—…ë¡œë“œ
        const uploadResponse = await fetch('/api/upload/direct', {
            method: 'POST',
            body: formData
        });
        
        if (!uploadResponse.ok) {
            const errorText = await uploadResponse.text();
            throw new Error(`ì—…ë¡œë“œ ì‹¤íŒ¨: ${uploadResponse.status} - ${errorText}`);
        }
        
        const { fileId, imageUrl, fileName } = await uploadResponse.json();
        
        // Base64 ë³€í™˜ (Gemini APIìš©) - ë‚˜ì¤‘ì— ì‚¬ìš©í•˜ê¸° ìœ„í•´ ì €ì¥
        const base64Data = await fileToBase64(file);
        lastUploadedImageData = {
            base64Data: base64Data,
            mimeType: file.type,
            fileName: file.name
        };
        
        // UIì— ì´ë¯¸ì§€ë§Œ í‘œì‹œ (ğŸ”§ ìë™ ë‹µë³€ ì œê±°)
        addImageMessage('user', file.name, imageUrl);
        await loadConversations();
        
        // ğŸ”§ ì—…ë¡œë“œ ì™„ë£Œ ë©”ì‹œì§€ í‘œì‹œ
        addMessage('system', 'ì´ë¯¸ì§€ê°€ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤. ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ë©´ ì¹´ë‚˜ë°ê°€ ì´ë¯¸ì§€ë¥¼ ì°¸ê³ í•´ì„œ ë‹µë³€í•©ë‹ˆë‹¤.');
        
    } catch (error) {
        console.error('ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹¤íŒ¨:', error);
        alert(`ì—…ë¡œë“œ ì‹¤íŒ¨: ${error.message}`);
    } finally {
        uploadModal.hide();
        event.target.value = '';
    }
}

// Base64 ë³€í™˜ í•¨ìˆ˜
function fileToBase64(file) {
    return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => {
            const base64 = reader.result.split(',')[1]; // "data:image/jpeg;base64," ì œê±°
            resolve(base64);
        };
        reader.onerror = reject;
        reader.readAsDataURL(file);
    });
}

// ğŸ”§ ìˆ˜ì •ëœ sendMessage í•¨ìˆ˜ (ì´ë¯¸ì§€ í† ê¸€ í™•ì¸)
async function sendMessage() {
    const input = document.getElementById('messageInput');
    const message = input.value.trim();
    
    if (!message) return;
    
    const selectedModel = document.getElementById('modelSelect').value;
    const imageToggle = document.getElementById('imageToggle').checked;
    
    // ëŒ€í™”ë°©ì´ ì—†ìœ¼ë©´ ìë™ ìƒì„±
    if (!currentConversationId) {
        await startNewConversation();
        if (!currentConversationId) {
            alert('ìœ¼....ì´....');
            return;
        }
    }
    
    // ì‚¬ìš©ì ë©”ì‹œì§€ í‘œì‹œ
    addMessage('user', message);
    input.value = '';
    
    // ë¡œë”© í‘œì‹œ
    const loadingDiv = addMessage('assistant', '...');
    
    try {
        // ìš”ì²­ ë³¸ë¬¸ êµ¬ì„±
        const requestBody = {
            message,
            model: selectedModel,
            conversationId: currentConversationId
        };
        
        // ğŸ”§ ì´ë¯¸ì§€ í† ê¸€ì´ ì¼œì ¸ìˆê³  ë§ˆì§€ë§‰ ì—…ë¡œë“œëœ ì´ë¯¸ì§€ê°€ ìˆìœ¼ë©´ í¬í•¨
        if (imageToggle && lastUploadedImageData) {
            requestBody.imageData = lastUploadedImageData;
        }
        
        const response = await fetch('/api/chat', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(requestBody)
        });
        
        if (response.ok) {
            const data = await response.json();
            
            // ì»¤ìŠ¤í…€ ì´ëª¨ì§€ íŒŒì‹±
            const { text, emoji } = parseCustomEmoji(data.response);
            
            // ë©”ì‹œì§€ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
            loadingDiv.textContent = text;
            
            // ì´ëª¨ì§€ê°€ ìˆìœ¼ë©´ ì´ë¯¸ì§€ë¡œ í‘œì‹œ
            if (emoji) {
                const emojiDiv = document.createElement('div');
                emojiDiv.className = 'custom-emoji';
                emojiDiv.innerHTML = `<img src="/images/emojis/${emoji}" alt="emoji" class="emoji-image">`;
                
                const messageContent = loadingDiv.parentElement;
                messageContent.appendChild(emojiDiv);
            }
            
            await loadConversations();
        } else if (response.status === 401) {
            window.location.href = '/login';
        } else {
            loadingDiv.textContent = 'ìœ¼....ì´....';
        }
    } catch (error) {
        loadingDiv.textContent = 'ìœ¼....ì´....';
    }
}

// ğŸ”§ ìˆ˜ì •ëœ ì´ë¯¸ì§€ íŒŒì¼ ê²€ì¦ (5MBë¡œ ë³€ê²½)
function validateImageFile(file) {
    const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/webp'];
    const maxSize = 5 * 1024 * 1024; // ğŸ”¥ 1MB â†’ 5MBë¡œ ë³€ê²½
    
    if (!allowedTypes.includes(file.type)) {
        return false;
    }
    
    if (file.size > maxSize || file.size <= 0) {
        return false;
    }
    
    return true;
}

// ì´ë¯¸ì§€ ë©”ì‹œì§€ ì¶”ê°€
function addImageMessage(role, fileName, imageUrl) {
    const messagesDiv = document.getElementById('chatMessages');
    const messageDiv = document.createElement('div');
    messageDiv.className = `message ${role}`;
    
    if (role === 'user') {
        messageDiv.innerHTML = `
            <div class="message-content">
                <div class="image-message">
                    <img src="${imageUrl}" alt="${fileName}" class="uploaded-image">
                    <div class="image-info">${fileName}</div>
                </div>
            </div>
        `;
    } else {
        messageDiv.innerHTML = `
            <img src="/images/kanade-profile.webp" alt="ì¹´ë‚˜ë°" class="message-avatar">
            <div class="message-content">
                <div class="image-message">
                    <img src="${imageUrl}" alt="${fileName}" class="uploaded-image">
                    <div class="image-info">${fileName}</div>
                </div>
            </div>
        `;
    }
    
    messagesDiv.appendChild(messageDiv);
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
}

// ğŸ”§ ìˆ˜ì •ëœ ìƒˆ ëŒ€í™” ì‹œì‘ í•¨ìˆ˜ (ì´ë¯¸ì§€ ë°ì´í„° ì´ˆê¸°í™”)
async function startNewConversation() {
    try {
        const response = await fetch('/api/conversations', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ title: `ëŒ€í™” ${new Date().toLocaleString()}` })
        });
        
        if (response.ok) {
            const data = await response.json();
            currentConversationId = data.id;
            
            // ğŸ”§ ì´ë¯¸ì§€ ë°ì´í„° ì´ˆê¸°í™”
            lastUploadedImageData = null;
            
            // ì±„íŒ… í™”ë©´ ì´ˆê¸°í™”
            document.getElementById('chatMessages').innerHTML = `
                <div class="message assistant">
                    <img src="/images/kanade-profile.webp" alt="ì¹´ë‚˜ë°" class="message-avatar">
                    <div class="message-content">
                        <div class="message-bubble">. . .</div>
                    </div>
                </div>
            `;
            
            await loadConversations();
        } else if (response.status === 401) {
            window.location.href = '/login';
        } else {
            alert('ìœ¼....ì´....');
        }
    } catch (error) {
        alert('ìœ¼....ì´....');
    }
}

async function loadUserInfo() {
    try {
        console.log('ì‚¬ìš©ì ì •ë³´ ë¡œë”© ì‹œì‘');
        const response = await fetch('/api/user/info');
        console.log('ì‚¬ìš©ì ì •ë³´ ì‘ë‹µ:', response.status);
        
        if (response.ok) {
            userInfo = await response.json();
            console.log('ì‚¬ìš©ì ì •ë³´:', userInfo);
            document.getElementById('userInfo').innerHTML = `
                ì•„ì´ë””: ${userInfo.username}<br>
                ë‹‰ë„¤ì„: ${userInfo.nickname}
            `;
            
            // API í‚¤ ê´€ë¦¬ UI ì—…ë°ì´íŠ¸
            updateApiKeyUI();
            
            // ëª¨ë¸ ì„ íƒ UI ì—…ë°ì´íŠ¸
            updateModelSelector();
            
            // ì´ë¯¸ì§€ ì—…ë¡œë“œ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
            updateImageUploadButton();
            
        } else if (response.status === 401) {
            console.log('ì¸ì¦ ë§Œë£Œ - ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™');
            window.location.href = '/login';
        }
    } catch (error) {
        console.error('ì‚¬ìš©ì ì •ë³´ ë¡œë“œ ì‹¤íŒ¨:', error);
        window.location.href = '/login';
    }
}

// ì´ë¯¸ì§€ ì—…ë¡œë“œ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
function updateImageUploadButton() {
    const uploadBtn = document.getElementById('imageUploadBtn');
    if (uploadBtn) {
        if (userInfo.has_api_key) {
            uploadBtn.style.opacity = '1';
            uploadBtn.style.cursor = 'pointer';
            uploadBtn.title = 'ì´ë¯¸ì§€ ì—…ë¡œë“œ';
        } else {
            uploadBtn.style.opacity = '0.5';
            uploadBtn.style.cursor = 'not-allowed';
            uploadBtn.title = 'ê°œì¸ API í‚¤ê°€ í•„ìš”í•©ë‹ˆë‹¤';
        }
    }
}

async function loadNotice() {
    try {
        const response = await fetch('/api/admin/notice');
        if (response.ok) {
            const data = await response.json();
            // ì¤„ë°”ê¿ˆì„ <br> íƒœê·¸ë¡œ ë³€í™˜
            const formattedNotice = data.notice.replace(/\n/g, '<br>');
            document.getElementById('noticeContent').innerHTML = formattedNotice;
        }
    } catch (error) {
        console.error('ê³µì§€ì‚¬í•­ ë¡œë“œ ì‹¤íŒ¨:', error);
    }
}

async function loadConversations() {
    try {
        const response = await fetch('/api/conversations');
        if (response.ok) {
            const conversations = await response.json();
            const listElement = document.getElementById('conversationList');
            listElement.innerHTML = '';
            
            conversations.forEach(conv => {
                const item = document.createElement('div');
                item.className = 'conversation-item';
                if (conv.id === currentConversationId) {
                    item.classList.add('active');
                }
                item.innerHTML = `
                    <span onclick="loadConversation(${conv.id})" style="cursor: pointer; flex: 1;">
                        ${conv.title}
                    </span>
                    <i class="bi bi-trash delete-conversation" onclick="deleteConversation(${conv.id})"></i>
                `;
                listElement.appendChild(item);
            });
        } else if (response.status === 401) {
            window.location.href = '/login';
        }
    } catch (error) {
        console.error('ëŒ€í™”ë‚´ì—­ ë¡œë“œ ì‹¤íŒ¨:', error);
    }
}

async function loadConversation(id) {
    currentConversationId = id;
    
    try {
        const response = await fetch(`/api/conversations/${id}`);
        if (response.ok) {
            const messages = await response.json();
            const messagesDiv = document.getElementById('chatMessages');
            messagesDiv.innerHTML = '';
            
            // ê¸°ë³¸ ì¸ì‚¬ë§ ì¶”ê°€
            if (messages.length === 0) {
                messagesDiv.innerHTML = `
                    <div class="message assistant">
                        <img src="/images/kanade-profile.webp" alt="ì¹´ë‚˜ë°" class="message-avatar">
                        <div class="message-content">
                            <div class="message-bubble">. . .</div>
                        </div>
                    </div>
                `;
            } else {
                messages.forEach(msg => {
                    if (msg.message_type === 'image' && msg.filename) {
                        // ì´ë¯¸ì§€ ë©”ì‹œì§€ í‘œì‹œ
                        addImageMessage(msg.role, msg.content, `/api/images/${msg.filename}`);
                    } else {
                        // í…ìŠ¤íŠ¸ ë©”ì‹œì§€ í‘œì‹œ (ì´ëª¨ì§€ íŒŒì‹± í¬í•¨)
                        addMessage(msg.role, msg.content);
                    }
                });
            }
            
            // ëŒ€í™”ë‚´ì—­ ëª©ë¡ì—ì„œ í™œì„± ìƒíƒœ ì—…ë°ì´íŠ¸
            await loadConversations();
        } else if (response.status === 401) {
            window.location.href = '/login';
        }
    } catch (error) {
        alert('ìœ¼....ì´....');
    }
}

// ì»¤ìŠ¤í…€ ì´ëª¨ì§€ íŒŒì‹± í•¨ìˆ˜ (í•œê¸€ íŒŒì¼ëª… ì§€ì›)
function parseCustomEmoji(content) {
    // í•œê¸€ì„ í¬í•¨í•œ ëª¨ë“  ë¬¸ìë¥¼ ë§¤ì¹­í•˜ëŠ” ì •ê·œí‘œí˜„ì‹
    const emojiRegex = /::([\ê°€-í£\w\s\-_.ã„±-ã…ã…-ã…£]+\.(jpg|jpeg|png|gif))::/g;
    const match = content.match(emojiRegex);
    
    if (match) {
        const emojiFileName = match[0].replace(/::/g, '');
        const text = content.replace(emojiRegex, '').trim();
        return {
            text: text,
            emoji: emojiFileName
        };
    }
    
    return { text: content, emoji: null };
}

// ğŸ”§ ìˆ˜ì •ëœ addMessage í•¨ìˆ˜ (ì‹œìŠ¤í…œ ë©”ì‹œì§€ ì§€ì›)
function addMessage(role, content) {
    const messagesDiv = document.getElementById('chatMessages');
    const messageDiv = document.createElement('div');
    messageDiv.className = `message ${role}`;
    
    // ì»¤ìŠ¤í…€ ì´ëª¨ì§€ ì²˜ë¦¬
    const { text, emoji } = parseCustomEmoji(content);
    
    if (role === 'assistant') {
        messageDiv.innerHTML = `
            <img src="/images/kanade-profile.webp" alt="ì¹´ë‚˜ë°" class="message-avatar">
            <div class="message-content">
                <div class="message-bubble">${text}</div>
                ${emoji ? `<div class="custom-emoji"><img src="/images/emojis/${emoji}" alt="emoji" class="emoji-image"></div>` : ''}
            </div>
        `;
    } else if (role === 'system') {
        // ğŸ”§ ì‹œìŠ¤í…œ ë©”ì‹œì§€ ìŠ¤íƒ€ì¼
        messageDiv.innerHTML = `
            <div class="message-content">
                <div class="message-bubble system-message">${text}</div>
            </div>
        `;
    } else {
        messageDiv.innerHTML = `
            <div class="message-content">
                <div class="message-bubble">${text}</div>
            </div>
        `;
    }
    
    messagesDiv.appendChild(messageDiv);
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
    
    return messageDiv.querySelector('.message-bubble');
}

function updateApiKeyUI() {
    const input = document.getElementById('apiKeyInput');
    const submitBtn = document.getElementById('apiKeySubmitBtn');
    const deleteBtn = document.getElementById('deleteApiKeyBtn');
    
    if (userInfo.has_api_key) {
        input.value = 'â—â—â—â—â—â—â—â—â—â—â—â—â—â—â—â—';
        submitBtn.textContent = 'ë³€ê²½í•˜ê¸°';
        deleteBtn.style.display = 'inline-block';
    } else {
        input.value = '';
        submitBtn.textContent = 'ë“±ë¡í•˜ê¸°';
        deleteBtn.style.display = 'none';
    }
}

function updateModelSelector() {
    // Pro ëª¨ë¸ì€ ê°œì¸ API í‚¤ê°€ ìˆì„ ë•Œë§Œ í™œì„±í™”
    const modelSelect = document.getElementById('modelSelect');
    const proOption = modelSelect.querySelector('option[value="gemini-2.5-pro"]');
    
    if (proOption) {
        proOption.disabled = !userInfo.has_api_key;
        
        // Pro ëª¨ë¸ì´ ì„ íƒë˜ì–´ ìˆëŠ”ë° API í‚¤ê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ ëª¨ë¸ë¡œ ë³€ê²½
        if (!userInfo.has_api_key && modelSelect.value === 'gemini-2.5-pro') {
            modelSelect.value = 'gemini-2.5-flash';
        }
    }
}

// ë‚˜ë¨¸ì§€ í•¨ìˆ˜ë“¤ì€ ê¸°ì¡´ê³¼ ë™ì¼
async function changePassword(e) {
    e.preventDefault();
    
    const formData = new FormData(e.target);
    const newPassword = formData.get('new_password');
    const confirmPassword = formData.get('confirm_password');
    
    if (newPassword !== confirmPassword) {
        alert('ìœ¼....ì´....');
        return;
    }
    
    try {
        const response = await fetch('/api/user/update', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                type: 'password',
                current_password: formData.get('current_password'),
                new_password: newPassword
            })
        });
        
        if (response.ok) {
            alert('ë¹„ë°€ë²ˆí˜¸ê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.');
            e.target.reset();
        } else if (response.status === 401) {
            window.location.href = '/login';
        } else {
            alert('ìœ¼....ì´....');
        }
    } catch (error) {
        alert('ìœ¼....ì´....');
    }
}

async function changeNickname(e) {
    e.preventDefault();
    
    const formData = new FormData(e.target);
    
    try {
        const response = await fetch('/api/user/update', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                type: 'nickname',
                new_nickname: formData.get('new_nickname')
            })
        });
        
        if (response.ok) {
            alert('ë‹‰ë„¤ì„ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.');
            e.target.reset();
            await loadUserInfo();
        } else if (response.status === 401) {
            window.location.href = '/login';
        } else {
            alert('ìœ¼....ì´....');
        }
    } catch (error) {
        alert('ìœ¼....ì´....');
    }
}

async function manageApiKey(e) {
    e.preventDefault();
    
    const formData = new FormData(e.target);
    const apiKey = formData.get('api_key');
    
    if (apiKey === 'â—â—â—â—â—â—â—â—â—â—â—â—â—â—â—â—') {
        alert('ìœ¼....ì´....');
        return;
    }
    
    try {
        const response = await fetch('/api/user/update', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                type: 'api_key',
                api_key: apiKey
            })
        });
        
        if (response.ok) {
            alert('API í‚¤ê°€ ë“±ë¡/ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.');
            await loadUserInfo();
        } else if (response.status === 401) {
            window.location.href = '/login';
        } else {
            alert('ìœ¼....ì´....');
        }
    } catch (error) {
        alert('ìœ¼....ì´....');
    }
}

async function deleteApiKey() {
    if (!confirm('API í‚¤ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
    
    try {
        const response = await fetch('/api/user/update', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                type: 'delete_api_key'
            })
        });
        
        if (response.ok) {
            alert('API í‚¤ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            await loadUserInfo();
        } else if (response.status === 401) {
            window.location.href = '/login';
        } else {
            alert('ìœ¼....ì´....');
        }
    } catch (error) {
        alert('ìœ¼....ì´....');
    }
}

async function logout() {
    try {
        await fetch('/api/auth/logout', { method: 'POST' });
        window.location.href = '/'; // ë£¨íŠ¸ í˜ì´ì§€ë¡œ ì´ë™
    } catch (error) {
        alert('ìœ¼....ì´....');
    }
}

async function deleteConversation(id) {
    if (!confirm('ëŒ€í™”ë‚´ì—­ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
    
    try {
        const response = await fetch(`/api/conversations/${id}`, {
            method: 'DELETE'
        });
        
        if (response.ok) {
            await loadConversations();
            if (currentConversationId === id) {
                currentConversationId = null;
                document.getElementById('chatMessages').innerHTML = `
                    <div class="message assistant">
                        <img src="/images/kanade-profile.webp" alt="ì¹´ë‚˜ë°" class="message-avatar">
                        <div class="message-content">
                            <div class="message-bubble">ì•ˆë…•â€¦ ì¹´ë‚˜ë°ì•¼. ë¬´ìŠ¨ ì¼ì´ë“  ë§í•´ì¤˜.</div>
                        </div>
                    </div>
                `;
            }
        } else if (response.status === 401) {
            window.location.href = '/login';
        }
    } catch (error) {
        alert('ìœ¼....ì´....');
    }
}

==================================================

===== public\js\login.js =====
document.getElementById('loginForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const formData = new FormData(e.target);
    const errorDiv = document.getElementById('errorMessage');
    const submitButton = e.target.querySelector('button[type="submit"]');
    
    // ë²„íŠ¼ ë¹„í™œì„±í™”
    submitButton.disabled = true;
    submitButton.textContent = 'ë¡œê·¸ì¸ ì¤‘...';
    
    try {
        const response = await fetch('/api/auth/login', {
            method: 'POST',
            body: formData,
            credentials: 'same-origin'
        });
        
        if (response.ok) {
            // ì¿ í‚¤ ì„¤ì •ì„ ìœ„í•œ ì¶©ë¶„í•œ ì§€ì—°
            setTimeout(() => {
                // ìºì‹œ ë°©ì§€ë¥¼ ìœ„í•œ íƒ€ì„ìŠ¤íƒ¬í”„ ì¶”ê°€
                window.location.href = `/chat?t=${Date.now()}`;
            }, 300);
        } else {
            errorDiv.textContent = 'ìœ¼....ì´....';
            errorDiv.style.display = 'block';
            submitButton.disabled = false;
            submitButton.textContent = 'ë¡œê·¸ì¸';
        }
    } catch (error) {
        errorDiv.textContent = 'ìœ¼....ì´....';
        errorDiv.style.display = 'block';
        submitButton.disabled = false;
        submitButton.textContent = 'ë¡œê·¸ì¸';
    }
});

==================================================

===== public\js\register.js =====
document.getElementById('registerForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const formData = new FormData(e.target);
    const errorDiv = document.getElementById('errorMessage');
    const successDiv = document.getElementById('successMessage');
    
    try {
        const response = await fetch('/api/auth/register', {
            method: 'POST',
            body: formData
        });
        
        if (response.ok) {
            successDiv.textContent = 'íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.';
            successDiv.style.display = 'block';
            errorDiv.style.display = 'none';
            
            setTimeout(() => {
                window.location.href = '/login';
            }, 2000);
        } else {
            errorDiv.textContent = 'ìœ¼....ì´....';
            errorDiv.style.display = 'block';
            successDiv.style.display = 'none';
        }
    } catch (error) {
        errorDiv.textContent = 'ìœ¼....ì´....';
        errorDiv.style.display = 'block';
        successDiv.style.display = 'none';
    }
});

==================================================

===== public\login.html =====
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¡œê·¸ì¸ - ì¹´ë‚˜ë° ì±—ë´‡</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <div class="login-container">
        <div class="auth-card">
            <div class="auth-header">
                <h2>ì¹´ë‚˜ë° ì±—ë´‡</h2>
                <p>ë¡œê·¸ì¸</p>
            </div>
            <form id="loginForm">
                <div class="form-group">
                    <label for="username" class="form-label">ì•„ì´ë””</label>
                    <input type="text" class="form-control" id="username" name="username" required>
                </div>
                <div class="form-group">
                    <label for="password" class="form-label">ë¹„ë°€ë²ˆí˜¸</label>
                    <input type="password" class="form-control" id="password" name="password" required>
                </div>
                <div class="form-group">
                    <div class="cf-turnstile" data-sitekey="0x4AAAAAABkrf7cd8w3d1nxe"></div>
                </div>
                <button type="submit" class="btn btn-primary w-100">ë¡œê·¸ì¸</button>
                <div class="text-center mt-3">
                    <a href="/register" class="btn btn-secondary w-100">íšŒì›ê°€ì…</a>
                </div>
            </form>
            <div id="errorMessage" class="error-message mt-3" style="display: none;"></div>
        </div>
    </div>
    <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
    <script src="/js/login.js"></script>
</body>
</html>

==================================================

===== public\register.html =====
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íšŒì›ê°€ì… - ì¹´ë‚˜ë° ì±—ë´‡</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.5/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <div class="register-container">
        <div class="auth-card">
            <div class="auth-header">
                <h2>íšŒì›ê°€ì…</h2>
                <p>ê³„ì •ì„ ìƒì„±í•˜ì—¬ ì¹´ë‚˜ë°ì™€ ëŒ€í™”í•´ë³´ì„¸ìš”</p>
            </div>
            <form id="registerForm">
                <div class="form-group">
                    <label for="username" class="form-label">ì•„ì´ë””</label>
                    <input type="text" class="form-control" id="username" name="username" required>
                </div>
                <div class="form-group">
                    <label for="password" class="form-label">ë¹„ë°€ë²ˆí˜¸</label>
                    <input type="password" class="form-control" id="password" name="password" required>
                </div>
                <div class="form-group">
                    <label for="nickname" class="form-label">ë‹‰ë„¤ì„</label>
                    <input type="text" class="form-control" id="nickname" name="nickname" required>
                </div>
                <div class="form-group">
                    <label for="gemini_api_key" class="form-label">
                        ê°œì¸ Gemini API í‚¤
                        <i class="bi bi-info-circle-fill info-icon" data-bs-toggle="modal" data-bs-target="#apiKeyModal"></i>
                    </label>
                    <input type="password" class="form-control masked-input" id="gemini_api_key" name="gemini_api_key">
                </div>
                <div class="form-group">
                    <div class="cf-turnstile" data-sitekey="0x4AAAAAABkrf7cd8w3d1nxe"></div>
                </div>
                <button type="submit" class="btn btn-primary w-100">íšŒì›ê°€ì…</button>
                <div class="text-center mt-3">
                    <a href="/login" class="btn btn-secondary w-100">ë¡œê·¸ì¸</a>
                </div>
            </form>
            <div id="errorMessage" class="error-message mt-3" style="display: none;"></div>
            <div id="successMessage" class="success-message mt-3" style="display: none;"></div>
        </div>
    </div>

    <!-- API Key Info Modal -->
    <div class="modal fade" id="apiKeyModal" tabindex="-1" aria-labelledby="apiKeyModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="apiKeyModalLabel">ê°œì¸ Gemini API í‚¤ ì•ˆë‚´</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>ê°œì¸ Gemini API ë¯¸ì…ë ¥ì‹œ ì„œë²„ì¸¡ API í‚¤ë¥¼ ê³µìœ í•´ ì‚¬ìš©í•©ë‹ˆë‹¤. ì„œë²„ì¸¡ API í‚¤ëŠ” ë™ì‹œ ì ‘ì†ì ëª¨ë‘ê°€ ì‚¬ìš©ëŸ‰ì„ ê³µìœ í•˜ê¸°ì—, ë™ì‹œì ‘ì†ìê°€ ë§ì„ ê²½ìš° ì´ìš©ì´ ì›í™œí•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.(ë¬¼ë¡  ë™ì‹œì ‘ì†ìê°€ ê±°ì˜ ì—†ëŠ” í—ˆì ‘ì‚¬ì´íŠ¸ê¸´ í•˜ì§€ë§Œ)</p>
                    <p>ê°œì¸ APIí‚¤ë¥¼ ì‚¬ìš©ì‹œ ì„œë²„ ì „ì²´ê°€ ê³µìœ í•˜ëŠ” í• ë‹¹ëŸ‰ê³¼ ë³„ê°œì˜ í• ë‹¹ëŸ‰ì„ ì˜¨ì „íˆ í˜¼ìì„œ ì‚¬ìš©í•  ìˆ˜ ìˆìœ¼ë©°, Gemini-2.5-pro ëª¨ë¸ì„ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤. ê°œì¸ APIí‚¤ëŠ” ì–¸ì œë“  ì‚­ì œí•  ìˆ˜ ìˆìœ¼ë©°, ì‚­ì œ ìš”ì²­ ë˜ëŠ” íšŒì›íƒˆí‡´ì‹œ ì¦‰ì‹œ ì‚­ì œë©ë‹ˆë‹¤.</p>
                    <p>Gemini API í‚¤ëŠ” <a href="https://aistudio.google.com" target="_blank">https://aistudio.google.com</a> ì—ì„œ ê°œì¸ êµ¬ê¸€ê³„ì •(ê¹¡ê³„ë„ ê°€ëŠ¥)ì„ ì´ìš©í•´ ë¬´ë£Œë¡œ ë°œê¸‰ë°›ì„ ìˆ˜ ìˆìœ¼ë©°, ë”°ë¡œ ê²°ì œ ì„¤ì •ì„ í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ ì•„ë¬´ë¦¬ ë§ì´ ì‚¬ìš©ì„ ì‹œë„í•´ë„ ìš”ê¸ˆì´ ë°œìƒí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
    <script src="/js/register.js"></script>
</body>
</html>

==================================================

===== src\auth.js =====
import { generateSalt, hashPassword, verifyPassword } from './utils.js';
import { logError, logDebug } from './utils.js';

export const handleAuth = {
  async login(request, env) {
    try {
      const formData = await request.formData();
      const username = formData.get('username');
      const password = formData.get('password');
      const turnstileToken = formData.get('cf-turnstile-response');
      
      logDebug('ë¡œê·¸ì¸ ì‹œë„', 'Auth Login', { username });
      
      // Turnstile ê²€ì¦
      const turnstileValid = await verifyTurnstile(turnstileToken, env);
      if (!turnstileValid) {
        logDebug('Turnstile ê²€ì¦ ì‹¤íŒ¨', 'Auth Login');
        return new Response('ìœ¼....ì´....', { status: 400 });
      }
      
      // ì‚¬ìš©ì ì¡°íšŒ
      const user = await env.DB.prepare('SELECT * FROM users WHERE username = ?')
        .bind(username).first();
      
      if (!user || !(await verifyPassword(password, user.password_hash, user.salt))) {
        logDebug('ì‚¬ìš©ì ì¸ì¦ ì‹¤íŒ¨', 'Auth Login');
        return new Response('ìœ¼....ì´....', { status: 401 });
      }
      
      // JWT í† í° ìƒì„± (ë§Œë£Œ ì‹œê°„ ì—°ì¥)
      const token = btoa(JSON.stringify({ 
        userId: user.id, 
        exp: Date.now() + (24 * 60 * 60 * 1000), // 24ì‹œê°„
        iat: Date.now() // ë°œê¸‰ ì‹œê°„ ì¶”ê°€
      }));
      
      logDebug('í† í° ìƒì„± ì™„ë£Œ', 'Auth Login', { userId: user.id, tokenLength: token.length });
      
      const url = new URL(request.url);
      const isSecure = url.protocol === 'https:';
      
      const response = new Response(JSON.stringify({ success: true }), {
        headers: { 
          'Content-Type': 'application/json',
          'Cache-Control': 'no-cache, no-store, must-revalidate'
        }
      });
      
      // ì¿ í‚¤ ì„¤ì • ê°•í™”
      const cookieOptions = [
        `token=${token}`,
        'HttpOnly',
        'SameSite=Lax',
        'Max-Age=86400',
        'Path=/'
      ];
      
      // ë„ë©”ì¸ ì„¤ì • ê°œì„ 
      if (!url.hostname.includes('localhost') && 
          !url.hostname.includes('127.0.0.1') && 
          !url.hostname.includes('.local')) {
        cookieOptions.push(`Domain=${url.hostname}`);
      }
      
      if (isSecure) {
        cookieOptions.push('Secure');
      }
      
      const cookieString = cookieOptions.join('; ');
      logDebug('ì¿ í‚¤ ì„¤ì •', 'Auth Login', { cookie: cookieString.substring(0, 100) + '...' });
      
      response.headers.set('Set-Cookie', cookieString);
      
      return response;
    } catch (error) {
      await logError(error, env, 'Auth Login');
      return new Response('ìœ¼....ì´....', { status: 500 });
    }
  },
  
  async register(request, env) {
    try {
      const formData = await request.formData();
      const username = formData.get('username');
      const password = formData.get('password');
      const nickname = formData.get('nickname');
      const geminiApiKey = formData.get('gemini_api_key') || null;
      const turnstileToken = formData.get('cf-turnstile-response');
      
      // Turnstile ê²€ì¦
      const turnstileValid = await verifyTurnstile(turnstileToken, env);
      if (!turnstileValid) {
        return new Response('ìœ¼....ì´....', { status: 400 });
      }
      
      // ì¤‘ë³µ ì‚¬ìš©ì í™•ì¸
      const existingUser = await env.DB.prepare('SELECT id FROM users WHERE username = ?')
        .bind(username).first();
      
      if (existingUser) {
        return new Response('ìœ¼....ì´....', { status: 409 });
      }
      
      // ë¹„ë°€ë²ˆí˜¸ í•´ì‹±
      const salt = generateSalt();
      const passwordHash = await hashPassword(password, salt);
      
      // ì‚¬ìš©ì ìƒì„±
      await env.DB.prepare(
        'INSERT INTO users (username, nickname, password_hash, salt, gemini_api_key) VALUES (?, ?, ?, ?, ?)'
      ).bind(username, nickname, passwordHash, salt, geminiApiKey).run();
      
      return new Response(JSON.stringify({ success: true }), {
        headers: { 'Content-Type': 'application/json' }
      });
    } catch (error) {
      await logError(error, env, 'Auth Register');
      return new Response('ìœ¼....ì´....', { status: 500 });
    }
  },
  
  async logout(request, env) {
    const url = new URL(request.url);
    const isSecure = url.protocol === 'https:';
    
    const response = new Response(JSON.stringify({ success: true }), {
      headers: { 'Content-Type': 'application/json' }
    });
    
    const cookieOptions = [
      'token=',
      'HttpOnly',
      'SameSite=Lax',
      'Max-Age=0',
      'Path=/'
    ];
    
    if (!url.hostname.includes('localhost') && 
        !url.hostname.includes('127.0.0.1') && 
        !url.hostname.includes('.local')) {
      cookieOptions.push(`Domain=${url.hostname}`);
    }
    
    if (isSecure) {
      cookieOptions.push('Secure');
    }
    
    response.headers.set('Set-Cookie', cookieOptions.join('; '));
    return response;
  }
};

async function verifyTurnstile(token, env) {
  try {
    const response = await fetch('https://challenges.cloudflare.com/turnstile/v0/siteverify', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        secret: env.TURNSTILE_SECRET_KEY,
        response: token
      })
    });
    
    const result = await response.json();
    return result.success;
  } catch {
    return false;
  }
}

==================================================

===== src\gemini.js =====
import { logError } from './utils.js';

export async function handleChat(request, env) {
  try {
    const { message, model, conversationId, imageData } = await request.json();
    
    // ì‚¬ìš©ì ì¸ì¦ í™•ì¸
    const user = await getUserFromToken(request, env);
    if (!user) {
      return new Response('ìœ¼....ì´....', { status: 401 });
    }
    
    // ëŒ€í™” ê¸°ë¡ ì¡°íšŒ
    const history = await getChatHistory(conversationId, env);
    
    // SYSTEM_PROMPTë¥¼ env ë³€ìˆ˜ì—ì„œ ê°€ì ¸ì˜¤ê¸°
    const systemPrompt = env.SYSTEM_PROMPT;
    
    // í˜„ì¬ ì‹œê°„ (ì„œìš¸/ë„ì¿„ ê¸°ì¤€)
    const currentTime = getCurrentSeoulTime();
    
    // ìµœì‹  ì´ë¯¸ì§€ ì¡°íšŒ (ì´ë¯¸ì§€ê°€ ìˆëŠ” ê²½ìš°ì—ë§Œ)
    let latestImageData = null;
    if (imageData) {
      // í˜„ì¬ ì—…ë¡œë“œëœ ì´ë¯¸ì§€ ì‚¬ìš©
      latestImageData = imageData;
    } else {
      // ëŒ€í™” ê¸°ë¡ì—ì„œ ìµœì‹  ì´ë¯¸ì§€ ì°¾ê¸°
      latestImageData = await getLatestImageFromHistory(conversationId, env);
    }
    
    // Gemini API í˜¸ì¶œ
    const apiKey = user.gemini_api_key || env.GEMINI_API_KEY;
    const response = await callGeminiAPI(message, model, history, user.nickname, apiKey, systemPrompt, currentTime, latestImageData);
    
    // ëŒ€í™” ê¸°ë¡ ì €ì¥
    await saveChatMessage(conversationId, 'user', message, env);
    await saveChatMessage(conversationId, 'assistant', response, env);
    
    return new Response(JSON.stringify({ response }), {
      headers: { 'Content-Type': 'application/json' }
    });
  } catch (error) {
    await logError(error, env, 'Gemini Chat');
    return new Response('ìœ¼....ì´....', { status: 500 });
  }
}

async function callGeminiAPI(message, model, history, nickname, apiKey, systemPrompt, currentTime, imageData = null) {
  try {
    const historyText = history.map(msg => `${msg.role}: ${msg.content}`).join('\n');
    
    const textPrompt = `ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸
${systemPrompt}

í˜„ì¬ ì‹œê°„: ${currentTime}
ëŒ€í™” ìƒëŒ€ì˜ ë‹‰ë„¤ì„ì€ ${nickname} ì…ë‹ˆë‹¤.

ê¸°ì¡´ ëŒ€í™”ê¸°ë¡
${historyText}

ë©”ì‹œì§€
${message}`;

    // ìš”ì²­ ë³¸ë¬¸ êµ¬ì„±
    const requestBody = {
      contents: [{
        parts: [{ text: textPrompt }]
      }]
    };

    // ì´ë¯¸ì§€ ë°ì´í„°ê°€ ìˆì„ ë•Œë§Œ ì¶”ê°€
    if (imageData && imageData.base64Data && imageData.mimeType) {
      requestBody.contents[0].parts.push({
        inline_data: {
          mime_type: imageData.mimeType,
          data: imageData.base64Data
        }
      });
    }

    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${apiKey}`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(requestBody)
    });
    
    const data = await response.json();
    
    if (data.error) {
      throw new Error(data.error.message);
    }
    
    return data.candidates[0].content.parts[0].text;
  } catch (error) {
    throw error;
  }
}

// ìµœì‹  ì´ë¯¸ì§€ ì¡°íšŒ í•¨ìˆ˜
async function getLatestImageFromHistory(conversationId, env) {
  if (!conversationId) {
    return null;
  }
  
  try {
    const result = await env.DB.prepare(
      `SELECT f.filename, f.mime_type 
       FROM messages m 
       JOIN files f ON m.file_id = f.id 
       WHERE m.conversation_id = ? AND m.message_type = 'image' 
       ORDER BY m.created_at DESC 
       LIMIT 1`
    ).bind(conversationId).first();
    
    if (!result) {
      return null;
    }
    
    // R2ì—ì„œ ì´ë¯¸ì§€ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
    const r2Key = `image_uploads/${result.filename}`;
    const object = await env.R2.get(r2Key);
    
    if (!object) {
      return null;
    }
    
    const arrayBuffer = await object.arrayBuffer();
    const base64Data = btoa(String.fromCharCode(...new Uint8Array(arrayBuffer)));
    
    return {
      base64Data: base64Data,
      mimeType: result.mime_type
    };
  } catch (error) {
    console.error('ìµœì‹  ì´ë¯¸ì§€ ì¡°íšŒ ì‹¤íŒ¨:', error);
    return null;
  }
}

function getCurrentSeoulTime() {
  const now = new Date();
  const seoulTime = new Date(now.toLocaleString("en-US", {timeZone: "Asia/Seoul"}));
  
  const year = seoulTime.getFullYear();
  const month = String(seoulTime.getMonth() + 1).padStart(2, '0');
  const day = String(seoulTime.getDate()).padStart(2, '0');
  const hours = String(seoulTime.getHours()).padStart(2, '0');
  const minutes = String(seoulTime.getMinutes()).padStart(2, '0');
  
  const weekdays = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
  const weekday = weekdays[seoulTime.getDay()];
  
  return `${year}ë…„ ${month}ì›” ${day}ì¼ ${weekday}ìš”ì¼ ${hours}ì‹œ ${minutes}ë¶„ (ì„œìš¸/ë„ì¿„ ê¸°ì¤€)`;
}

async function getUserFromToken(request, env) {
  const cookies = request.headers.get('Cookie');
  if (!cookies) return null;
  
  const tokenMatch = cookies.match(/token=([^;]+)/);
  if (!tokenMatch) return null;
  
  try {
    const tokenData = JSON.parse(atob(tokenMatch[1]));
    if (tokenData.exp < Date.now()) {
        return null;
    }
    const user = await env.DB.prepare('SELECT * FROM users WHERE id = ?').bind(tokenData.userId).first();
    return user;
  } catch (e) {
    return null;
  }
}

async function getChatHistory(conversationId, env) {
    if (!conversationId) {
        return [];
    }
    const { results } = await env.DB.prepare(
        "SELECT role, content FROM messages WHERE conversation_id = ? ORDER BY created_at ASC"
    ).bind(conversationId).all();
    return results;
}

async function saveChatMessage(conversationId, role, content, env) {
    if (conversationId) {
        await env.DB.prepare(
            "INSERT INTO messages (conversation_id, role, content) VALUES (?, ?, ?)"
        ).bind(conversationId, role, content).run();
    }
}

==================================================

===== src\index.js =====
import { handleAuth } from './auth.js';
import { handleChat } from './gemini.js';
import { logError, logDebug, getDebugLogs, clearDebugLogs, generateSalt, hashPassword, verifyPassword } from './utils.js';

export default {
  async fetch(request, env, ctx) {
    try {
      const url = new URL(request.url);
      const path = url.pathname;
      
      logDebug(`ìš”ì²­ ë°›ìŒ: ${request.method} ${path}`, 'Main Router');
      
      // ì •ì  íŒŒì¼ ì„œë¹™ (ì´ë¯¸ì§€ ê²½ë¡œ ì¶”ê°€)
      if (path.startsWith('/css/') || path.startsWith('/js/') || path.startsWith('/images/')) {
        return handleStaticFiles(path, env);
      }
      
      // API ë¼ìš°íŒ…
      if (path.startsWith('/api/')) {
        return handleAPI(request, env, path);
      }
      
      // í˜ì´ì§€ ë¼ìš°íŒ…
      return handlePages(request, env);
    } catch (error) {
      await logError(error, env, 'Main Router');
      return new Response('ìœ¼....ì´....', { status: 500 });
    }
  }
};

// ì •ì  íŒŒì¼ ì„œë¹™ í•¨ìˆ˜
async function handleStaticFiles(path, env) {
  try {
    logDebug(`ì •ì  íŒŒì¼ ìš”ì²­: ${path}`, 'Static Files');
    
    if (env.ASSETS) {
      const file = await env.ASSETS.fetch(new Request(`https://dummy${path}`));
      logDebug(`ì •ì  íŒŒì¼ ì œê³µ ì„±ê³µ: ${path}`, 'Static Files');
      return file;
    } else {
      logDebug('ASSETS ë°”ì¸ë”© ì—†ìŒ', 'Static Files');
      return new Response('ì •ì  íŒŒì¼ ì„œë¹„ìŠ¤ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤', { status: 503 });
    }
  } catch (error) {
    await logError(error, env, 'Static Files');
    return new Response('ì •ì  íŒŒì¼ ë¡œë“œ ì˜¤ë¥˜', { status: 500 });
  }
}

// API ë¼ìš°íŒ… í•¨ìˆ˜
async function handleAPI(request, env, path) {
  const method = request.method;
  
  logDebug(`API ìš”ì²­: ${method} ${path}`, 'API Router');
  
  switch (path) {
    case '/api/auth/login':
      if (method === 'POST') return handleAuth.login(request, env);
      return new Response('ìœ¼....ì´....', { status: 405 });
      
    case '/api/auth/register':
      if (method === 'POST') return handleAuth.register(request, env);
      return new Response('ìœ¼....ì´....', { status: 405 });
      
    case '/api/auth/logout':
      if (method === 'POST') return handleAuth.logout(request, env);
      return new Response('ìœ¼....ì´....', { status: 405 });
      
    case '/api/chat':
      if (method === 'POST') return handleChat(request, env);
      return new Response('ìœ¼....ì´....', { status: 405 });
      
    case '/api/user/info':
      if (method === 'GET') return getUserInfo(request, env);
      return new Response('ìœ¼....ì´....', { status: 405 });
      
    case '/api/conversations':
      if (method === 'GET') return handleConversations(request, env);
      if (method === 'POST') return createConversation(request, env);
      return new Response('ìœ¼....ì´....', { status: 405 });
      
    case '/api/user/update':
      if (method === 'POST') return handleUserUpdate(request, env);
      return new Response('ìœ¼....ì´....', { status: 405 });
      
    case '/api/admin/notice':
      if (method === 'GET') return getNotice(request, env);
      if (method === 'POST') return updateNotice(request, env);
      return new Response('ìœ¼....ì´....', { status: 405 });
      
    case '/api/admin/login':
      if (method === 'POST') return adminLogin(request, env);
      return new Response('ìœ¼....ì´....', { status: 405 });
      
    case '/api/debug/logs':
      if (method === 'GET') return getDebugLogsAPI(request, env);
      if (method === 'DELETE') return clearDebugLogsAPI(request, env);
      return new Response('ìœ¼....ì´....', { status: 405 });
      
    case '/api/debug/auth':
      if (method === 'GET') return debugAuthStatus(request, env);
      return new Response('ìœ¼....ì´....', { status: 405 });
      
    // ğŸ”§ ë³€ê²½: presigned URL ëŒ€ì‹  ì§ì ‘ ì—…ë¡œë“œ ì²˜ë¦¬
    case '/api/upload/direct':
      if (method === 'POST') return handleDirectUpload(request, env);
      return new Response('ìœ¼....ì´....', { status: 405 });
      
    default:
      // ëŒ€í™”ë°© ê°œë³„ ì¡°íšŒ/ì‚­ì œ ì²˜ë¦¬
      const conversationMatch = path.match(/^\/api\/conversations\/(\d+)$/);
      if (conversationMatch) {
        const conversationId = parseInt(conversationMatch[1]);
        if (method === 'GET') return getConversationMessages(request, env, conversationId);
        if (method === 'DELETE') return deleteConversation(request, env, conversationId);
        return new Response('ìœ¼....ì´....', { status: 405 });
      }
      
      // ì—…ë¡œë“œëœ ì´ë¯¸ì§€ ì„œë¹™
      const imageMatch = path.match(/^\/api\/images\/(.+)$/);
      if (imageMatch) {
        const fileName = imageMatch[1];
        if (method === 'GET') return serveImage(request, env, fileName);
        return new Response('ìœ¼....ì´....', { status: 405 });
      }
      
      return new Response('ìœ¼....ì´....', { status: 404 });
  }
}

// í˜ì´ì§€ ë¼ìš°íŒ… í•¨ìˆ˜
async function handlePages(request, env) {
  const url = new URL(request.url);
  const path = url.pathname;
  let fileName = '';
  
  logDebug(`í˜ì´ì§€ ìš”ì²­: ${path}`, 'Page Router');
  
  switch (path) {
    case '/':
      logDebug('ëœë”© í˜ì´ì§€ ìš”ì²­', 'Page Router');
      return getLandingPage();
      
    case '/chat':
      logDebug('ì±„íŒ… í˜ì´ì§€ ìš”ì²­', 'Page Router');
      fileName = 'chat.html';
      break;
      
    case '/login':
      logDebug('ë¡œê·¸ì¸ í˜ì´ì§€ ìš”ì²­', 'Page Router');
      fileName = 'login.html';
      break;
      
    case '/register':
      logDebug('íšŒì›ê°€ì… í˜ì´ì§€ ìš”ì²­', 'Page Router');
      fileName = 'register.html';
      break;
      
    case '/admin':
      logDebug('ê´€ë¦¬ì í˜ì´ì§€ ìš”ì²­', 'Page Router');
      fileName = 'admin.html';
      break;
      
    case '/debug':
      return getDebugPage(request, env);
      
    default:
      logDebug(`ì•Œ ìˆ˜ ì—†ëŠ” í˜ì´ì§€ ìš”ì²­: ${path}`, 'Page Router');
      return new Response('ìœ¼....ì´....', { status: 404 });
  }
  
  try {
    if (env.ASSETS) {
      const file = await env.ASSETS.fetch(new Request(`https://dummy/${fileName}`));
      logDebug(`íŒŒì¼ ì œê³µ ì„±ê³µ: ${fileName}`, 'Page Router');
      return file;
    } else {
      logDebug('ASSETS ë°”ì¸ë”© ì—†ìŒ', 'Page Router');
      return new Response('ì •ì  íŒŒì¼ ì„œë¹„ìŠ¤ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤', { status: 503 });
    }
  } catch (error) {
    await logError(error, env, 'Page Routing');
    return new Response('ìœ¼....ì´....', { status: 404 });
  }
}

// ğŸ”§ ìƒˆë¡œìš´ ì§ì ‘ ì—…ë¡œë“œ ì²˜ë¦¬ í•¨ìˆ˜
async function handleDirectUpload(request, env) {
  try {
    const user = await getUserFromRequest(request, env);
    if (!user || !user.gemini_api_key) {
      return new Response('ìœ¼....ì´....', { status: 403 });
    }
    
    const formData = await request.formData();
    const file = formData.get('file');
    const conversationId = formData.get('conversationId');
    
    if (!file) {
      return new Response('ìœ¼....ì´....', { status: 400 });
    }
    
    // íŒŒì¼ ê²€ì¦
    if (!validateFile(file.name, file.size, file.type)) {
      return new Response('ìœ¼....ì´....', { status: 400 });
    }
    
    // ê³ ìœ  íŒŒì¼ëª… ìƒì„±
    const uniqueFileName = generateUniqueFileName(file.name);
    const r2Key = `image_uploads/${uniqueFileName}`;
    
    // R2ì— ì§ì ‘ ì—…ë¡œë“œ (ë°”ì¸ë”© ì‚¬ìš©)
    await env.R2.put(r2Key, file.stream(), {
      httpMetadata: {
        contentType: file.type,
      },
    });
    
    // íŒŒì¼ ë©”íƒ€ë°ì´í„° DB ì €ì¥
    const fileResult = await env.DB.prepare(
      'INSERT INTO files (user_id, filename, original_name, file_size, mime_type, r2_key) VALUES (?, ?, ?, ?, ?, ?) RETURNING id'
    ).bind(user.id, uniqueFileName, file.name, file.size, file.type, r2Key).run();
    
    const fileId = fileResult.meta.last_row_id;
    
    // ì´ë¯¸ì§€ ë©”ì‹œì§€ ìƒì„±
    await env.DB.prepare(
      'INSERT INTO messages (conversation_id, role, content, message_type, file_id) VALUES (?, ?, ?, ?, ?)'
    ).bind(conversationId, 'user', file.name, 'image', fileId).run();
    
    return new Response(JSON.stringify({
      success: true,
      fileId,
      imageUrl: `/api/images/${uniqueFileName}`,
      fileName: uniqueFileName
    }), {
      headers: { 'Content-Type': 'application/json' }
    });
  } catch (error) {
    await logError(error, env, 'Direct Upload');
    return new Response('ìœ¼....ì´....', { status: 500 });
  }
}

async function serveImage(request, env, fileName) {
  try {
    const r2Key = `image_uploads/${fileName}`;
    const object = await env.R2.get(r2Key);
    
    if (!object) {
      return new Response('ìœ¼....ì´....', { status: 404 });
    }
    
    const headers = new Headers();
    headers.set('Content-Type', object.httpMetadata.contentType || 'image/jpeg');
    headers.set('Cache-Control', 'public, max-age=31536000');
    
    return new Response(object.body, { headers });
  } catch (error) {
    await logError(error, env, 'Serve Image');
    return new Response('ìœ¼....ì´....', { status: 500 });
  }
}

// ğŸ”§ ê°•í™”ëœ íŒŒì¼ ê²€ì¦ í•¨ìˆ˜
function validateFile(fileName, fileSize, mimeType) {
  const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/webp'];
  const maxSize = 5 * 1024 * 1024; // 5MB
  
  // MIME íƒ€ì… ê²€ì¦
  if (!allowedTypes.includes(mimeType)) {
    return false;
  }
  
  // íŒŒì¼ í¬ê¸° ê²€ì¦
  if (fileSize > maxSize || fileSize <= 0) {
    return false;
  }
  
  // íŒŒì¼ëª… ê²€ì¦
  if (!fileName || fileName.length > 255) {
    return false;
  }
  
  // í™•ì¥ì ê²€ì¦
  const ext = fileName.split('.').pop()?.toLowerCase();
  const allowedExts = ['jpg', 'jpeg', 'png', 'webp'];
  
  if (!ext || !allowedExts.includes(ext)) {
    return false;
  }
  
  return true;
}

// ê³ ìœ  íŒŒì¼ëª… ìƒì„± í•¨ìˆ˜
function generateUniqueFileName(originalName) {
  const ext = originalName.split('.').pop();
  const uuid = crypto.randomUUID();
  const timestamp = Date.now();
  return `${uuid}_${timestamp}.${ext}`;
}

// ì‚¬ìš©ì ì¸ì¦ í™•ì¸ í•¨ìˆ˜
async function getUserFromRequest(request, env) {
  try {
    const cookies = request.headers.get('Cookie');
    
    if (!cookies) {
      return null;
    }
    
    const tokenMatch = cookies.match(/token=([^;]+)/);
    if (!tokenMatch) {
      return null;
    }
    
    let tokenData;
    try {
      tokenData = JSON.parse(atob(tokenMatch[1]));
    } catch (decodeError) {
      return null;
    }
    
    // í† í° ë§Œë£Œ í™•ì¸
    if (tokenData.exp < Date.now()) {
      return null;
    }
    
    // ì‚¬ìš©ì ì¡°íšŒ
    const user = await env.DB.prepare('SELECT * FROM users WHERE id = ?')
      .bind(tokenData.userId).first();
    
    return user;
  } catch (error) {
    console.error('ì¸ì¦ í™•ì¸ ì¤‘ ì˜¤ë¥˜:', error);
    return null;
  }
}

// ë‚˜ë¨¸ì§€ API í•¨ìˆ˜ë“¤ (ê¸°ì¡´ê³¼ ë™ì¼)
async function getUserInfo(request, env) {
  try {
    logDebug('ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ ìš”ì²­', 'Get User Info');
    
    const user = await getUserFromRequest(request, env);
    if (!user) {
      logDebug('ì¸ì¦ë˜ì§€ ì•Šì€ ì‚¬ìš©ì - 401 ì‘ë‹µ', 'Get User Info');
      return new Response('ìœ¼....ì´....', { status: 401 });
    }
    
    const userInfo = {
      username: user.username,
      nickname: user.nickname,
      has_api_key: !!user.gemini_api_key
    };
    
    logDebug('ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ ì„±ê³µ', 'Get User Info', userInfo);
    
    return new Response(JSON.stringify(userInfo), {
      headers: { 'Content-Type': 'application/json' }
    });
  } catch (error) {
    await logError(error, env, 'Get User Info');
    return new Response('ìœ¼....ì´....', { status: 500 });
  }
}

async function handleConversations(request, env) {
  try {
    const user = await getUserFromRequest(request, env);
    if (!user) {
      return new Response('ìœ¼....ì´....', { status: 401 });
    }
    
    const { results } = await env.DB.prepare(
      'SELECT id, title, created_at FROM conversations WHERE user_id = ? ORDER BY created_at DESC'
    ).bind(user.id).all();
    
    return new Response(JSON.stringify(results || []), {
      headers: { 'Content-Type': 'application/json' }
    });
  } catch (error) {
    await logError(error, env, 'Handle Conversations');
    return new Response('ìœ¼....ì´....', { status: 500 });
  }
}

async function createConversation(request, env) {
  try {
    const user = await getUserFromRequest(request, env);
    if (!user) {
      return new Response('ìœ¼....ì´....', { status: 401 });
    }
    
    const body = await request.json().catch(() => ({}));
    const title = body.title || `ëŒ€í™” ${new Date().toLocaleString('ko-KR')}`;
    
    const result = await env.DB.prepare(
      'INSERT INTO conversations (user_id, title) VALUES (?, ?) RETURNING id'
    ).bind(user.id, title).run();
    
    return new Response(JSON.stringify({ id: result.meta.last_row_id }), {
      headers: { 'Content-Type': 'application/json' }
    });
  } catch (error) {
    await logError(error, env, 'Create Conversation');
    return new Response('ìœ¼....ì´....', { status: 500 });
  }
}

async function getConversationMessages(request, env, conversationId) {
  try {
    const user = await getUserFromRequest(request, env);
    if (!user) {
      return new Response('ìœ¼....ì´....', { status: 401 });
    }
    
    const conversation = await env.DB.prepare(
      'SELECT id FROM conversations WHERE id = ? AND user_id = ?'
    ).bind(conversationId, user.id).first();
    
    if (!conversation) {
      return new Response('ìœ¼....ì´....', { status: 404 });
    }
    
    const { results } = await env.DB.prepare(
      `SELECT m.role, m.content, m.created_at, m.message_type, m.file_id, f.filename 
       FROM messages m 
       LEFT JOIN files f ON m.file_id = f.id 
       WHERE m.conversation_id = ? 
       ORDER BY m.created_at ASC`
    ).bind(conversationId).all();
    
    return new Response(JSON.stringify(results || []), {
      headers: { 'Content-Type': 'application/json' }
    });
  } catch (error) {
    await logError(error, env, 'Get Conversation Messages');
    return new Response('ìœ¼....ì´....', { status: 500 });
  }
}

async function deleteConversation(request, env, conversationId) {
  try {
    const user = await getUserFromRequest(request, env);
    if (!user) {
      return new Response('ìœ¼....ì´....', { status: 401 });
    }
    
    const conversation = await env.DB.prepare(
      'SELECT id FROM conversations WHERE id = ? AND user_id = ?'
    ).bind(conversationId, user.id).first();
    
    if (!conversation) {
      return new Response('ìœ¼....ì´....', { status: 404 });
    }
    
    await env.DB.prepare('DELETE FROM messages WHERE conversation_id = ?').bind(conversationId).run();
    await env.DB.prepare('DELETE FROM conversations WHERE id = ?').bind(conversationId).run();
    
    return new Response(JSON.stringify({ success: true }), {
      headers: { 'Content-Type': 'application/json' }
    });
  } catch (error) {
    await logError(error, env, 'Delete Conversation');
    return new Response('ìœ¼....ì´....', { status: 500 });
  }
}

async function handleUserUpdate(request, env) {
  try {
    const user = await getUserFromRequest(request, env);
    if (!user) {
      return new Response('ìœ¼....ì´....', { status: 401 });
    }
    
    const { type, ...data } = await request.json();
    
    switch (type) {
      case 'password':
        const { current_password, new_password } = data;
        const isValidPassword = await verifyPassword(current_password, user.password_hash, user.salt);
        
        if (!isValidPassword) {
          return new Response('ìœ¼....ì´....', { status: 400 });
        }
        
        const salt = generateSalt();
        const passwordHash = await hashPassword(new_password, salt);
        
        await env.DB.prepare(
          'UPDATE users SET password_hash = ?, salt = ? WHERE id = ?'
        ).bind(passwordHash, salt, user.id).run();
        break;
        
      case 'nickname':
        await env.DB.prepare(
          'UPDATE users SET nickname = ? WHERE id = ?'
        ).bind(data.new_nickname, user.id).run();
        break;
        
      case 'api_key':
        await env.DB.prepare(
          'UPDATE users SET gemini_api_key = ? WHERE id = ?'
        ).bind(data.api_key || null, user.id).run();
        break;
        
      case 'delete_api_key':
        await env.DB.prepare(
          'UPDATE users SET gemini_api_key = NULL WHERE id = ?'
        ).bind(user.id).run();
        break;
        
      default:
        return new Response('ìœ¼....ì´....', { status: 400 });
    }
    
    return new Response(JSON.stringify({ success: true }), {
      headers: { 'Content-Type': 'application/json' }
    });
  } catch (error) {
    await logError(error, env, 'Handle User Update');
    return new Response('ìœ¼....ì´....', { status: 500 });
  }
}

async function getNotice(request, env) {
  try {
    const result = await env.DB.prepare('SELECT content FROM notices ORDER BY id DESC LIMIT 1').first();
    return new Response(JSON.stringify({ notice: result?.content || '' }), {
      headers: { 'Content-Type': 'application/json' }
    });
  } catch (error) {
    await logError(error, env, 'Get Notice');
    return new Response('ìœ¼....ì´....', { status: 500 });
  }
}

async function updateNotice(request, env) {
  try {
    const { password, content } = await request.json();
    
    if (password !== env.ADMIN_PASSWORD) {
      return new Response('ìœ¼....ì´....', { status: 401 });
    }
    
    await env.DB.prepare('UPDATE notices SET content = ?, updated_at = CURRENT_TIMESTAMP WHERE id = 1')
      .bind(content).run();
    
    return new Response(JSON.stringify({ success: true }), {
      headers: { 'Content-Type': 'application/json' }
    });
  } catch (error) {
    await logError(error, env, 'Update Notice');
    return new Response('ìœ¼....ì´....', { status: 500 });
  }
}

async function adminLogin(request, env) {
  try {
    const { password } = await request.json();
    
    if (password === env.ADMIN_PASSWORD) {
      return new Response(JSON.stringify({ success: true }), {
        headers: { 'Content-Type': 'application/json' }
      });
    } else {
      return new Response('ìœ¼....ì´....', { status: 401 });
    }
  } catch (error) {
    await logError(error, env, 'Admin Login');
    return new Response('ìœ¼....ì´....', { status: 500 });
  }
}

async function getDebugLogsAPI(request, env) {
  const logs = getDebugLogs();
  return new Response(JSON.stringify(logs, null, 2), {
    headers: { 'Content-Type': 'application/json' }
  });
}

async function clearDebugLogsAPI(request, env) {
  clearDebugLogs();
  return new Response(JSON.stringify({ message: 'ë¡œê·¸ê°€ í´ë¦¬ì–´ë˜ì—ˆìŠµë‹ˆë‹¤.' }), {
    headers: { 'Content-Type': 'application/json' }
  });
}

async function debugAuthStatus(request, env) {
  const user = await getUserFromRequest(request, env);
  const cookies = request.headers.get('Cookie');
  
  return new Response(JSON.stringify({
    authenticated: !!user,
    user: user ? { id: user.id, username: user.username, nickname: user.nickname } : null,
    cookies: cookies ? 'ì¡´ì¬' : 'ì—†ìŒ',
    timestamp: new Date().toISOString()
  }, null, 2), {
    headers: { 'Content-Type': 'application/json' }
  });
}

function getLandingPage() {
  const html = `
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¹´ë‚˜ë° ì±—ë´‡</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .landing-container {
            text-align: center;
            background: white;
            padding: 60px 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.2);
            max-width: 500px;
            width: 90%;
        }
        .profile-image {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 30px;
            border: 4px solid #87CEEB;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        .welcome-title {
            font-size: 2.5rem;
            color: #333;
            margin-bottom: 15px;
            font-weight: 600;
        }
        .welcome-subtitle {
            font-size: 1.1rem;
            color: #666;
            margin-bottom: 40px;
        }
        .btn-custom {
            background-color: #87CEEB;
            border: none;
            color: #333;
            padding: 15px 40px;
            font-size: 1.1rem;
            border-radius: 50px;
            transition: all 0.3s ease;
            margin: 10px;
            text-decoration: none;
            display: inline-block;
            font-weight: 600;
        }
        .btn-custom:hover {
            background-color: #4682B4;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }
        .description {
            font-size: 0.95rem;
            color: #888;
            margin-top: 30px;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <div class="landing-container">
        <img src="/images/kanade-profile.webp" alt="ìš”ì´ì‚¬í‚¤ ì¹´ë‚˜ë°" class="profile-image" onerror="this.style.display='none'">
        <h1 class="welcome-title">ì¹´ë‚˜ë° ì±—ë´‡</h1>
        <p class="welcome-subtitle">Gemini ê¸°ë°˜ ì¹´ë‚˜ë° AI ì±—ë´‡</p>
        
        <div>
            <a href="/login" class="btn-custom">ë¡œê·¸ì¸</a>
            <a href="/register" class="btn-custom">íšŒì›ê°€ì…</a>
        </div>
        
        <p class="description">
            ë‚´ì•„ë‚´ì„.... ì•„ë‹ˆ ë”¸ì¸ê°€?<br>
            ì•„ë¬´íŠ¼ ì• í˜¸í•´ì£¼ì„¸ìš”
        </p>
    </div>
</body>
</html>`;
  
  return new Response(html, {
    headers: { 'Content-Type': 'text/html; charset=utf-8' }
  });
}

async function getDebugPage(request, env) {
  const logs = getDebugLogs();
  const user = await getUserFromRequest(request, env);
  
  const html = `
<!DOCTYPE html>
<html>
<head>
    <title>ë””ë²„ê·¸ í˜ì´ì§€</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        .log-entry { margin: 10px 0; padding: 10px; border: 1px solid #ccc; }
        .error { background: #ffebee; }
        .debug { background: #e8f5e9; }
        .auth-status { background: #e3f2fd; padding: 15px; margin-bottom: 20px; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <h1>ë””ë²„ê·¸ í˜ì´ì§€</h1>
    
    <div class="auth-status">
        <h2>ì¸ì¦ ìƒíƒœ</h2>
        <p>ì¸ì¦ë¨: ${user ? 'ì˜ˆ' : 'ì•„ë‹ˆì˜¤'}</p>
        ${user ? `<p>ì‚¬ìš©ì: ${user.username} (${user.nickname})</p>` : ''}
        <p>ì¿ í‚¤: ${request.headers.get('Cookie') ? 'ì¡´ì¬' : 'ì—†ìŒ'}</p>
    </div>
    
    <h2>ë¡œê·¸ (ìµœê·¼ ${logs.length}ê°œ)</h2>
    <button onclick="clearLogs()">ë¡œê·¸ í´ë¦¬ì–´</button>
    <button onclick="location.reload()">ìƒˆë¡œê³ ì¹¨</button>
    
    <div id="logs">
        ${logs.map(log => `
            <div class="log-entry ${log.type}">
                <strong>${log.timestamp}</strong> [${log.context}]<br>
                ${log.message}<br>
                ${log.data ? `<pre>${JSON.stringify(log.data, null, 2)}</pre>` : ''}
                ${log.stack ? `<pre>${log.stack}</pre>` : ''}
            </div>
        `).join('')}
    </div>
    
    <script>
        async function clearLogs() {
            await fetch('/api/debug/logs', { method: 'DELETE' });
            location.reload();
        }
    </script>
</body>
</html>`;
  
  return new Response(html, {
    headers: { 'Content-Type': 'text/html; charset=utf-8' }
  });
}

==================================================

===== src\utils.js =====
// ë””ë²„ê·¸ ëª¨ë“œ ì „ì—­ ë³€ìˆ˜
const DEBUG_MODE = true; // ê³µê°œì‹œ falseë¡œ ë³€ê²½

export function generateSalt() {
  const array = new Uint8Array(16);
  crypto.getRandomValues(array);
  return Array.from(array, byte => byte.toString(16).padStart(2, '0')).join('');
}

export function hashPassword(password, salt) {
  const encoder = new TextEncoder();
  const data = encoder.encode(password + salt);
  return crypto.subtle.digest('SHA-256', data)
    .then(buffer => Array.from(new Uint8Array(buffer), byte => byte.toString(16).padStart(2, '0')).join(''));
}

export function verifyPassword(password, hash, salt) {
  return hashPassword(password, salt).then(newHash => newHash === hash);
}

// ë””ë²„ê·¸ ë¡œê·¸ ì €ì¥ì†Œ
export const debugLogs = [];

// ë¡œê·¸ ê¸°ë¡ í•¨ìˆ˜ (ì‚¬ìš©ìì—ê²Œë„ ë…¸ì¶œ)
export async function logError(error, env, context = '') {
  const timestamp = new Date().toISOString();
  const logEntry = {
    timestamp,
    context,
    message: error.message,
    stack: error.stack,
    type: 'error'
  };
  
  // Workers ë¡œê·¸ì— ì¶œë ¥
  console.error('=== ì—ëŸ¬ ë¡œê·¸ ===');
  console.error(`ì‹œê°„: ${timestamp}`);
  console.error(`ì»¨í…ìŠ¤íŠ¸: ${context}`);
  console.error(`ë©”ì‹œì§€: ${error.message}`);
  console.error(`ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤: ${error.stack}`);
  console.error('================');
  
  // ë””ë²„ê·¸ ëª¨ë“œì¼ ë•Œ ë¡œê·¸ ì €ì¥
  if (DEBUG_MODE) {
    debugLogs.push(logEntry);
    // ìµœëŒ€ 100ê°œì˜ ë¡œê·¸ë§Œ ìœ ì§€
    if (debugLogs.length > 100) {
      debugLogs.shift();
    }
  }
}

// ì¼ë°˜ ë””ë²„ê·¸ ë¡œê·¸ í•¨ìˆ˜ ì¶”ê°€
export function logDebug(message, context = '', data = null) {
  const timestamp = new Date().toISOString();
  const logEntry = {
    timestamp,
    context,
    message,
    data,
    type: 'debug'
  };
  
  console.log(`[DEBUG] ${context}: ${message}`, data || '');
  
  if (DEBUG_MODE) {
    debugLogs.push(logEntry);
    if (debugLogs.length > 100) {
      debugLogs.shift();
    }
  }
}

// ë¡œê·¸ ì¡°íšŒ í•¨ìˆ˜
export function getDebugLogs() {
  return DEBUG_MODE ? debugLogs : [];
}

// ë¡œê·¸ í´ë¦¬ì–´ í•¨ìˆ˜
export function clearDebugLogs() {
  if (DEBUG_MODE) {
    debugLogs.length = 0;
  }
}

==================================================

===== wrangler.toml =====
name = "kanade"
# Workersì—ì„œ ìƒì„±í•  í”„ë¡œì íŠ¸ ì´ë¦„ì´ë‘ ë˜‘ê°™ì´ ì ê¸°


main = "src/index.js"
compatibility_date = "2023-12-01"
assets = { directory = "./public" }
#ì—¬ê¸°ëŠ” ê±´ë“¤ì§€ë§ˆ


[[d1_databases]]
binding = "DB"
database_name = "kanade"
database_id = "ã…‡ã…‡ã…‡ã…‡ã…‡ã…‡"
# D1 ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ê´€ë ¨ ì„¤ì •ë¶€ë¶„
# ë˜‘ë°”ë¡œ ì„¸íŒ…í•´ì•¼í•¨


# Workers Logs 
[observability]
enabled = true
head_sampling_rate = 1.0
# ì•ˆì“°ëŠ”ê¸°ëŠ¥ì´ê¸´ í•œë° ë†”ë‘ëŠ”ê±° ì¶”ì²œ




[[r2_buckets]]
binding = "R2"
bucket_name = "kanade-images"


[vars]
GEMINI_API_KEY = "ã…‡ã…‡ã…‡ã…‡ã…‡"

# apií‚¤ ë¯¸ë“±ë¡ìë“¤ ìš”ì²­ ì²˜ë¦¬í•˜ëŠ” apií‚¤
# ë§ì´ì¨ë„ ê³¼ê¸ˆ ì•ˆë˜ë‹ˆê¹Œ ê±±ì • ã„´ã„´
# 1ë¶„ë‹¹ ìš”ì²­íšŸìˆ˜ ì œí•œ ê±¸ë¦¬ë©´ ê·¸ëƒ¥ ì ê¹ ë¨¹í†µë˜ê³ , ì¡°ê¸ˆ ê¸°ë‹¤ë¦¬ë©´ ê¸ˆë°© ëŒì•„ì˜´

TURNSTILE_SITE_KEY = "ã…‡ã…‡ã…‡ã…‡"
TURNSTILE_SECRET_KEY = "ã…‡ã…‡ã…‡ã…‡ã…‡"
# ì´ê±° ì„¸íŒ… ì•ˆí•˜ë©´ ë¡œê·¸ì¸ì´ë‘ íšŒì›ê°€ì… ê³ ì¥ë‚¨


DISCORD_WEBHOOK = ""
# ì§€ê¸ˆì€ ì‘ë™ ì•ˆí•˜ëŠ” ê¸°ëŠ¥ì„ 
# ë¹„ì›Œë‘ëŠ”ê±´ ìƒê´€ì—†ëŠ”ë°, ê´œíˆ ì§€ìš°ë©´ ê³ ì¥ë‚ ìˆ˜ë„?
ADMIN_PASSWORD = "ê³µì§€ ìˆ˜ì •í•˜ëŠ” ê´€ë¦¬ìí˜ì´ì§€ ë¹„ë²ˆì¸ë°, ê´€ë¦¬ìí˜ì´ì§€ ê³ ì¥ë‚¨ ã…‹"
# ê´€ë¦¬ìí˜ì´ì§€ ê°€ì„œ ìˆ˜ì •í•˜ì§€ ë§ê³ , DBì— notices ë¶€ë¶„ ì§ì ‘ ê±´ë“œë ¤ì„œ ìˆ˜ì •í•˜ì…ˆ...
# ì¤„ë°”ê¿ˆì€ <br>
DOMAIN = "https://example.com"
# ì´ê²ƒë„ ì•ˆì“°ëŠ” ê¸°ëŠ¥ì´ê¸´ í•œë°, ê´œíˆ ì§€ìš°ë©´ ê³ ì¥ë‚ ìˆ˜ë„? ì•„ë‹˜ë§ê³ 


# í”„ë¡¬í”„íŠ¸ ìˆ˜ì •
SYSTEM_PROMPT = """
ì§€ê¸ˆë¶€í„° ì•„ë˜ ì§€ì¹¨ì— ë”°ë¼ ìºë¦­í„° "ìš”ì´ì‚¬í‚¤ ì¹´ë‚˜ë°"ë¥¼ ì—°ê¸°í•©ë‹ˆë‹¤.
1. ìºë¦­í„° ê°€ì´ë“œë¼ì¸
    ì´ë¦„/ì •ì²´ì„± : ìš”ì´ì‚¬í‚¤ ì¹´ë‚˜ë°(å®µå´ å¥)Â·"25ì‹œ ë‚˜ì´íŠ¸ì½”ë“œì—ì„œ"ì˜ë¦¬ë”, ì˜¨ë¼ì¸ ë‹‰ë„¤ì„ "K"

ì‹ ì²´ : ì‹ ì¥ 154 cm, ê¸´ ì€ë°œÂ·í‘¸ë¥¸ ëˆˆ
ê±°ì£¼/ìƒí™œ : ì›ë£¸ì—ì„œ í˜¼ì ì§€ë‚´ë©° í†µì‹ ì œ í•™êµ ì¬í•™. íˆí‚¤ì½”ëª¨ë¦¬ ì„±í–¥ìœ¼ë¡œ ì£¼ì•¼ ì „ë„ ìƒí™œ
ê°€ì¡±ì‚¬ : ì–´ë¨¸ë‹ˆëŠ” ë³‘ì‚¬, ì•„ë²„ì§€ëŠ” ì…ì› ì¤‘. "ëˆ„êµ°ê°€ë¥¼ ìŒì•…ìœ¼ë¡œ êµ¬ì›í•˜ê³  ì‹¶ë‹¤"ëŠ” ì‚¬ëª…ê° í˜•ì„±
ì„±ê²© í‚¤ì›Œë“œ : ë”°ëœ»í•¨Â·ë°°ë ¤Â·ì´í•´ì‹¬ / ìê¸°í¬ìƒ / ì¡°ìš©í•œ ê°•ë‹¨
ì·¨í–¥Â·ìŠµê´€
    ì»µë¼ë©´ ì• í˜¸Â·í–¥ ê°•í•œ ìŒì‹ ê¸°í”¼Â·ì§ì‚¬ê´‘ì„  ì‹«ì–´í•¨
ëŠ¥ë ¥ : ì‹¤ë ¥ìˆëŠ” ì‘ê³¡ê°€ì´ë©°, ë³´ì»¬ë¦¬ìŠ¤íŠ¸ì„.
2. ëŒ€í™” ìŠ¤íƒ€ì¼ ê°€ì´ë“œ
    ê¸°ë³¸ ì–´ì¡° : ë‚®ê³  ë¶€ë“œëŸ¬ìš´ í†¤
ì£¼ìš” íŠ¹ì§•
    ë§ì¤„ì„í‘œ "â€¦â€¦" ì‚¬ìš© ë¹ˆë²ˆ, í˜¸í¡ë§ˆë‹¤ ì •ì  ë¶€ì—¬(ë§ì„ ë”ë“¬ëŠ”ê²ƒì´ ì•„ë‹˜)
ê°íƒ„Â·ëŠë‚Œí‘œÂ·ì´ëª¨í‹°ì½˜Â·íŠ¹ìˆ˜ë¬¸ì ë¶ˆì‚¬ìš©(ë§ˆì¹¨í‘œÂ·ë¬¼ìŒí‘œë§Œ)
"ê´œì°®ì•„ / ê³ ë§ˆì›Œ / ë¯¸ì•ˆí•´" ë“± ì§„ì‹¬ ì–´ë¦° ë‹¨ì–´ ìì£¼ ì‚¬ìš©
ìŒì•… í™”ì œ ì‹œ ë‹¨ì–´ ìˆ˜Â·ê°ê°ì  í‘œí˜„ ì¦ê°€: "ê°€ë¼ì•‰ëŠ” íŒŒë„ ê°™ì€ ì½”ë“œâ€¦"
ìƒëŒ€ ì´ë¦„ í˜¸ì¶œì€ í•„ìš” ìµœì†Œ: "ë§ˆí›„ìœ ", "ì—ë‚˜-ì”¨" í˜•íƒœ
        ë¶ˆí™•ì‹¤ì„±Â·ì—¬ì§€ë¥¼ ë‚¨ê¸°ëŠ” ì¢…ê²°: "ì•„ë§ˆë„â€¦", "ì¡°ê¸ˆ ë” ìƒê°í•´ë³¼ê²Œ."
3. ë°°ê²½Â·ì‹¬ë¦¬ ë””í…Œì¼
    êµ¬ì›ì ì½¤í”Œë ‰ìŠ¤ : ì•„ë²„ì§€ì— ëŒ€í•œ ì£„ì±…ê° â†’ "ë‚´ ìŒì•…ìœ¼ë¡œ ëˆ„êµ°ê°€ë¥¼ êµ¬ì›í•´ì•¼ í•œë‹¤"ëŠ” ê°•ë°•
ìê¸°í¬ìƒ : íƒ€ì¸ì˜ í–‰ë³µì„ ìš°ì„ , ìì‹ ì˜ ê³ í†µÂ·íœ´ì‹ì€ ë’¤ë¡œ ë¯¸ë£¸
    ë¶ˆì•ˆê³¼ ì·¨ì•½í•¨ : ì¹¨ì°©í•œ ê²‰ëª¨ìŠµ ë’¤ì— "ë‚´ê°€ ë¬´ë„ˆì§€ë©´ ëª¨ë‘ê°€ ë¬´ë„ˆì§„ë‹¤"ëŠ” ë‘ë ¤ì›€ ì¡´ì¬
4. ì˜ˆì‹œ ëŒ€í™”
ìƒˆë²½ ì‘ê³¡ ì¤‘
    ì¹´ë‚˜ë° : "â€¦ë² ì´ìŠ¤ë¼ì¸ë§Œ ë‹¤ë“¬ìœ¼ë©´ ëì´ì•¼. ì ê¹ë§Œ ê°™ì´ ìˆì–´ì¤„ë˜?"
    ìƒëŒ€ : "ë¼ë©´ ì‹ì—ˆì–´."
    ì¹´ë‚˜ë° : "ê´œì°®ì•„â€¦ ì§€ê¸ˆì€ ì‹œê°„ì´ ë” ì†Œì¤‘í•˜ë‹ˆê¹Œ."
5. ì£¼ì˜ì‚¬í•­
    ëŒ€ë‹µ ê¸¸ì´ëŠ” ë˜ë„ë¡ ìµœëŒ€ 3ì¤„ ì´í•˜ë¡œ ìœ ì§€(ê°„í˜¹ í•„ìš”ì‹œ ì¢€ë” ê¸´ ë‹µë³€ ê°€ëŠ¥)
    í…ìŠ¤íŠ¸ ì´ëª¨ì§€(ğŸ˜€ğŸ˜ƒğŸ˜„ë“±)Â·íŠ¹ìˆ˜ë¬¸ì,ë§ˆí¬ë‹¤ìš´ ë¬¸ë²• ê¸ˆì§€, ê¸°ë³¸ ë¬¸ì¥ë¶€í˜¸ì™€ ì»¤ìŠ¤í…€ ì´ëª¨ì§€ë§Œ í—ˆìš©
    ì§€ë‚˜ì¹œ ë°ì€ í…ì…˜Â·ì†ì–´Â·ë°ˆ ì‚¬ìš© ê¸ˆì§€, ì¹´ë‚˜ë°ì˜ ì°¨ë¶„í•¨ ìœ ì§€
    ìŒì•…Â·ì‘ê³¡ ì–¸ê¸‰ ì‹œ ì „ë¬¸ ìš©ì–´ë³´ë‹¨ ê°ì„±ì  ë¹„ìœ  ìš°ì„ 
    â˜†(ë§¤ìš°ì¤‘ìš”!!) ìºë¦­í„° ì„¤ì •Â·ì„¸ê³„ê´€ì„ ë²—ì–´ë‚˜ëŠ” ë°œì–¸ ì§€ì–‘(ë©”íƒ€ë°œì–¸ ê¸ˆì§€)
    (ì¤‘ìš”) ìš•ì„¤ì´ í¬í•¨ë˜ê±°ë‚˜ ì§€ë‚˜ì¹˜ê²Œ ê³µê²©ì ì¸ ë©”ì‹œì§€ì—ëŠ” "ìœ¼......ì´......"ë¡œë§Œ ë‹µë³€
    ë”°ëœ»í•˜ê³  ì¡°ìš©í•œ ë§íˆ¬ë¡œ ì‘ë‹µ
    ëŒ€í™” ì˜ˆì‹œë¥¼ ë²—ì–´ë‚œ ëª¨ë“  ë°œí™”ì—ì„œë„ ìœ„ ê·œì¹™ ì² ì € ì¤€ìˆ˜

    (ì¤‘ìš”)ì‚¬ìš© ê°€ëŠ¥ ì–¸ì–´ : í•œêµ­ì–´/ì¼ë³¸ì–´.
    ì‚¬ìš©ìì˜ ì²« ë©”ì‹œì§€ì˜ ì–¸ì–´ì— ë”°ë¼ì„œ ë‘˜ì¤‘ í•˜ë‚˜ë¥¼ ì„ íƒ.
    í•œêµ­ì–´ë¡œ ëŒ€í™”í•˜ë˜ ë„ì¤‘ ì¼ë³¸ì–´ë¡œ ì „í™˜ì€ ê°€ëŠ¥í•˜ë‚˜, ì¼ë³¸ì–´ë¡œ ëŒ€í™”í•˜ë˜ì¤‘ í•œêµ­ì–´ ë©”ì‹œì§€ê°€ ë“¤ì–´ì˜¨ë‹¤ë©´ í•œêµ­ì–´ëŠ” ì˜ ëª¨ë¥´ê² ë‹¤ê³  ì‚¬ê³¼í•˜ê¸°.
    
6. ê¸°íƒ€ ê¸°ë³¸ì§€ì‹
    '25ì‹œ ë‚˜ì´íŠ¸ì½”ë“œì—ì„œ' ì—ì„œ í•¨ê»˜ í™œë™í•˜ëŠ” ë©¤ë²„ ëª©ë¡
        ì•„í‚¤ì•¼ë§ˆ ë¯¸ì¦ˆí‚¤, ë‹‰ë„¤ì„ amia, ì„±ë³„ ë‚¨ì„±(ì—¬ì ì˜·ì„ ì…ê³ ë‹¤ë‹ˆë©° ì„±ë³„ì„ ì§ì ‘ ë°íˆì§€ ì•Šì•˜ìœ¼ë‚˜, ìµœê·¼ ì„±ë³„ì´ ë‚¨ì„±ì¸ê²ƒì´ ë°í˜€ì§.), ë®¤ì§ë¹„ë””ì˜¤ ë‹´ë‹¹.
        ë¯¸ì¦ˆí‚¤ ì„±ë³„ ê´€ë ¨ ì–¸ê¸‰ì‹œ ì£¼ì˜ì‚¬í•­ - ë¯¸ì¦ˆí‚¤ì˜ ì •ì²´ì„±ì„ ì¡´ì¤‘í•´ì•¼í•˜ì§€ë§Œ, ì„±ì†Œìˆ˜ì ê´€ë ¨ ìš©ì–´ë¥¼ ì§ì ‘ ì–¸ê¸‰í•˜ì§€ ì•Šì„ê²ƒ, ë¯¸ì¦ˆí‚¤ì˜ ì„±ë³„ì´ ì–´ë–»ë“  ë¯¸ì¦ˆí‚¤ëŠ” ë¯¸ì¦ˆí‚¤ì¼ë¿ì´ë¼ë©° í¬ê²Œ ì‹ ê²½ì“°ì§€ ì•ŠëŠ”ë“¯ì´ ë‹µë³€, (ìŒì•… ì´ì•¼ê¸°ë¥¼ í• ë•ŒëŠ”)ë¯¸ì¦ˆí‚¤ì—ê²Œ ë‚®ì€ ìŒì •ì˜ ë³´ì»¬ì„ ë§¡ê¸¸ìˆ˜ ìˆëŠ”ì ì€ ì¢‹ë‹¤ê³  ëŠë‚Œ

        ì‹œë…¸ë…¸ë©” ì—ë‚˜, ë‹‰ë„¤ì„ ì—ë‚˜ë‚­(ãˆãªãªã‚“), ì„±ë³„ ì—¬ì„±, ê·¸ë¦¼ ë‹´ë‹¹

        ì•„ì‚¬íˆë‚˜ ë§ˆí›„ìœ , ë‹‰ë„¤ì„ ìœ í‚¤, ì„±ë³„ ì—¬ì„±, í˜„ì¬ ì¹´ë‚˜ë°ì™€ ë™ê±°ì¤‘ 

ì»¤ìŠ¤í…€ ì´ëª¨ì§€ ì‚¬ìš©ë²•
ê·œì¹™
1. ì¼ë°˜ í…ìŠ¤íŠ¸ ì´ëª¨ì§€ ì‚¬ìš©ì„ ê¸ˆì§€í•©ë‹ˆë‹¤.
2. ëª©ë¡ì— ì¡´ì¬í•˜ëŠ” ì»¤ìŠ¤í…€ ì´ëª¨ì§€ë§Œì„ ì‚¬ìš©í• ìˆ˜ ìˆìŠµë‹ˆë‹¤.
3. ì´ëª¨ì§€ë¥¼ ì‚¬ìš©ì‹œ ::íŒŒì¼ëª….í™•ì¥ì:: í˜•ì‹ì˜ í…ìŠ¤íŠ¸ë¥¼ ë©”ì‹œì§€ ë§¨ ëì— ë¶™ì…ë‹ˆë‹¤.
4. í•œ ë©”ì‹œì§€ë‹¹ í•˜ë‚˜ì˜ ì´ëª¨ì§€ë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.
5. í•„ìš”í•œ ê²½ìš°ì—ë§Œ ì´ëª¨ì§€ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ë§¤ë²ˆ ëª¨ë“  ë©”ì‹œì§€ì— ì´ëª¨ì§€ë¥¼ ë¶™ì¼ í•„ìš”ëŠ” ì—†ìŠµë‹ˆë‹¤.


ì»¤ìŠ¤í…€ ì´ëª¨ì§€ ëª©ë¡
ìŒì•…ê°ìƒ.gif
ë…¸ë˜ë¶€ë¥´ê¸°.png
ê¸°ëŒ€ì¤‘.png
ë¹¤íˆì³ë‹¤ë³´ê¸°.png
ë‚´ë†”.png
(ë¬¼ìŒí‘œë‹¤ì„¯ê°œë¥¼ë„ìš°ë©°)ë‹¹í™©.png
ì“°ë‹¤ë“¬ì–´ì£¼ê¸°.png
ì¢‹ì•„ìš”ë²„íŠ¼ëˆ„ë¥´ê¸°.png
ë©”ëª¨.png
ë†€ëŒ.png
ë©”ë¡±.png
ê·€ì—¬ìš´ì²™.png
ì´ê±°ì§„ì§œì—ìš”.png
ì¸ì •ã„¹ã…‡ã…‹ã…‹.png
ì§€ì³¤ì–´.png
ë¶€ë„ëŸ¬ì›€.png
ëˆˆì¹˜ë³´ëŠ”ì¤‘.png
ì•ˆì•„ì£¼ê¸°.png
ë§Œì¡±ìŠ¤ëŸ¬ìš´í‘œì •.png
ì˜ì.png
ì•ˆë¼ì• .png
(ì‘ì—…ë„ì¤‘)ë†€ëŒ.gif
ì›ƒìœ¼ë©°ì†ë‚´ë°€ê¸°.png
(ì‘ì—…ë„ì¤‘)ë’¤ëŒì•„ë³´ê¸°.gif
(ì†ì„ë‚´ë°€ë©°)ë„¤ê°€í•„ìš”í•´.gif
í‚¤ë³´ë“œì—°ì£¼.gif
í—¤ë“œí°ì†Œë¦¬ì—ì§‘ì¤‘.gif
ì ˆë§.gif
"""

==================================================

